var USL_Admin;!function(a){USL_Admin={init:function(){}},a(function(){USL_Admin.init()})}(jQuery);var USL_MCECallbacks;!function(a){USL_MCECallbacks={visualLoadCounter:{count:0,total:0},preShortcode:function(b,c,d,e,f){d=d?d:"span",e=e?e:"",f="undefined"==typeof f?!1:f;var g="",h='<span class="usl-tinymce-shortcode-code" data-code="'+b+'"></span>';return e+=f?"":"styled",c&&(g+='<span class="usl-tinymce-shortcode-atts" data-atts=\'',a.each(c,function(a,b){g+='"'+a+'": "'+b+'", '}),g+="'></span>"),"<"+d+' class="usl-tinymce-shortcode-wrapper '+b+" "+e+'">'+g+h},postShortcode:function(a){return a="undefined"==typeof a?"span":a,'<span class="usl-tinymce-shortcode-wrapper-end"></span></'+a+">&nbsp;"},convertLiteralToRendered:function(b,c){var d=new RegExp("\\[.*?](.*?\\[\\/.*?])?","gi"),e=b.match(d);if(e){USL_tinymce.loading(!0),this.visualLoadCounter.total=e.length,this.visualLoadCounter.count=0;for(var f=0;f<e.length;f++){var g=e[f],h=this.getAtts(g),i=e[f].match(/\[(.*?)(?=\s|])/),j=i?i[1]:!1,k={};if(j)if(j in USL_Data.all_shortcodes)if(j in USL_Data.rendered_shortcodes)"undefined"!=typeof USL_Data.render_data&&(k=USL_Data.render_data),k.action="usl_render_shortcode",k.shortcode=g,k.atts=h,k.code=j,k.total=e.length,a.post(ajaxurl,k,function(a){var b="",d=c.getContent(),e=a.shortcode,f=USL_Data.rendered_shortcodes[a.code].displayBlock?"div":"span",g=USL_Data.rendered_shortcodes[a.code].classes?USL_Data.rendered_shortcodes[a.code].classes:"",h=USL_Data.rendered_shortcodes[a.code].noStyle?USL_Data.rendered_shortcodes[a.code].noStyle:"";e=e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),b+=USL_MCECallbacks.preShortcode(a.code,a.atts,f,g,h),b+=a.output,b+=USL_MCECallbacks.postShortcode(f),c.setContent(d.replace(new RegExp(e,"g"),b)),USL_MCECallbacks.updateCounter()});else{var l="",m=c.getContent(),n=g.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");n=new RegExp(n,"g"),l+=USL_MCECallbacks.preShortcode(j),l+=j,l+=USL_MCECallbacks.postShortcode(),c.setContent(m.replace(n,l)),this.updateCounter()}else this.updateCounter();else this.updateCounter()}}},convertRenderedToLiteral:function(b){var c=new RegExp('<(span|div)\\s*?class="usl-tinymce-shortcode-wrapper.*?(data-atts="(.*?)")?.*?data-code="(.*?)".*?(<span class="usl-tinymce-shortcode-content">(.*?)<\\/span>)?.*?usl-tinymce-shortcode-wrapper-end"><\\/span><\\/(span|div)>',"gi"),d=b.match(c);if(!d)return b;for(var e=0;e<d.length;e++){var f=d[e],g=this.getVisualAtts(d[e]),h=this.getVisualContent(d[e]),i=this.getVisualCode(d[e]),j="["+i;g&&a.each(g,function(a,b){j+=" "+a+'="'+b+'"'}),j+="]",h.length&&(j+=h+"[/"+i+"]"),b=b.replace(new RegExp(f,"g"),j)}return b},updateCounter:function(){this.visualLoadCounter.count++,this.visualLoadCounter.count==this.visualLoadCounter.total&&USL_tinymce.loading(!1)},getAtts:function(b,c){var d=b.match(/\s.*?(?==)/g),e=b.match(/"([^"]+)"/g),f={};if(null!==d)for(var g=0;g<d.length;g++)f[d[g].trim()]=e[g].substring(1,e[g].length-1);return c&&a.each(c,function(a,b){f[a]||(f[a]=b)}),f},getShortcodeContent:function(a){var b=a.match(/\](.*)\[/);return null!==b?b[1]:""},getVisualAtts:function(a){var b=a.match(/<span class="usl-tinymce-shortcode-atts.*?data-atts="(.*?), ".*?<\/span>/i);return b?JSON.parse("{"+b[1].replace(/&quot;/gi,'"')+"}"):!1},getVisualContent:function(a){var b=a.match(/<span class="usl-tinymce-shortcode-content.*?>(.*?)<\/span>/i);return b?b[1]:!1},getVisualCode:function(a){var b=a.match(/<span class="usl-tinymce-shortcode-code.*?data-code="(.*?)".*?<\/span>/i);return b[1]},showContent:function(a,b){var c=b.length?" "+b.join(" "):"";return'<span class="usl-tinymce-shortcode-content'+c+'">'+a+"</span>"}}}(jQuery);var USL_Modal;!function(a){function b(){this.original_value=null,this.fieldname=null,this.shortcode=null,this.$container=null,this.$input=null,this.init=function(a){this.$container=a,this.$input=this.$container.find(".usl-modal-att-input"),this.fieldname=this.$container.find(".usl-modal-att-name").text().trim(),this.shortcode=this.$container.closest(".usl-modal-shortcode").attr("data-code"),this._storeOriginalValue()},this._storeOriginalValue=function(){this.original_value=this.$input.val(),this.storeOriginalValue()},this._revert=function(){this.$input.val(this.original_value),this.setValid(),this.revert()},this.getValue=function(){return this.$input.val()},this.setValue=function(a){this.$input.val(a)},this.setInvalid=function(a){this.$container.addClass("invalid"),this.errorMsg(a)},this.setValid=function(){this.$container.removeClass("invalid")},this.errorMsg=function(a){"undefined"==typeof this.$errormsg&&(this.$errormsg=this.$container.find(".usl-modal-att-errormsg")),this.$errormsg.html(a)},this.storeOriginalValue=function(){},this.revert=function(){}}var c,d,e={},f=!1;USL_Modal={output:"",init:function(){this.establishElements(),this.binds(),this.keyboardShortcuts(),this.attsInit(),this.preventWindowScroll(),this.search(),this.slidersInit(),this.colorpickersInit()},load:function(){},resize:function(){this.listHeight()},establishElements:function(){e.wrap=a("#usl-modal-wrap"),e.submit=a("#usl-modal-submit"),e.backdrop=a("#usl-modal-backdrop"),e.cancel=e.wrap.find(".usl-modal-cancel"),e.close=e.wrap.find(".usl-modal-close"),e.remove=a("#usl-modal-remove"),e.title=e.wrap.find(".usl-modal-title"),e.search=e.wrap.find(".usl-modal-search"),e.categories=e.wrap.find(".usl-modal-categories"),e.footer=e.wrap.find(".usl-modal-footer"),e.list=e.wrap.find(".usl-modal-shortcodes"),e.active_shortcode="",e.search_input=e.wrap.find('input[name="usl-modal-search"]')},binds:function(){e.list.find(".accordion-section-title, .usl-modal-sc-title").click(function(){USL_Modal.activateShortcode(a(this))}),e.submit.off("click").click(function(a){a.preventDefault(),USL_Modal.update()}),e.remove.click(function(){a(document).trigger("usl-modal-remove")}),e.cancel.click(function(a){a.preventDefault(),USL_Modal.close()}),e.close.click(function(a){a.preventDefault(),USL_Modal.close()}),e.categories.find("li").click(function(){USL_Modal.filterByCategory(a(this))}),e.list.find(".usl-modal-show-advanced-atts").click(function(){return USL_Modal.toggleAdvancedAtts(a(this)),!1})},keyboardShortcuts:function(){a(document).keyup(function(a){if(f){switch(a.which){case 13:USL_Modal.update();break;case 27:USL_Modal.close();break;case 40:var b=e.active_shortcode.next();b.length&&(USL_Modal.closeShortcode(),e.active_shortcode=b,USL_Modal.openShortcode());break;case 38:var c=e.active_shortcode.prev();c.length&&(USL_Modal.closeShortcode(),e.active_shortcode=c,USL_Modal.openShortcode())}13==a.which}})},attsInit:function(){e.list.find(".usl-modal-att-row").each(function(){var b,c=a(this).attr("data-att-type");switch(c){case"selectbox":b=new h(a(this));break;case"colorpicker":b=new j(a(this));break;case"slider":b=new k(a(this));break;default:b=new g(a(this))}a(this).data("attObj",b)})},colorpickersInit:function(){e.list.find(".usl-modal-att-colorpicker").each(function(){var b=a(this).data();a(this).wpColorPicker(b)})},slidersInit:function(){e.list.find(".usl-modal-att-slider").each(function(){var b=a(this),c=b.data(),d=b.siblings(".usl-modal-att-slider-value");c.slide=function(a,b){d.val(b.value)},d.change(function(){b.slider("value",a(this).val())}),b.slider(c)})},search:function(){var b,f=1e3,g=300;e.search_input.on("keyup",function(h){if(13!=h.which&&27!=h.which&&40!=h.which&&38!=h.which){var i=a(this).val();d||e.list.animate({opacity:0},g),d=!0,b=""===i?g:f,clearTimeout(c),c=setTimeout(function(){d=!1,e.list.animate({opacity:1},g),USL_Modal.closeShortcode(),e.list.find(".usl-modal-shortcode").each(function(){var b=a(this).find(".usl-modal-shortcode-title").text(),c=a(this).find(".description").text(),d=a(this).attr("data-code"),e=b+c+d;e.indexOf(i)<0?a(this).hide():a(this).show()})},b)}})},clearSearch:function(){e.search_input.val(""),e.list.find(".usl-modal-shortcode").show(),clearTimeout(c),e.list.css("opacity",1),d=!1},activateShortcode:function(a){var b=a.closest(".usl-modal-shortcode");b.hasClass("active")||(USL_Modal.closeShortcode(),e.active_shortcode=b,USL_Modal.openShortcode())},toggleAdvancedAtts:function(a){"Show advanced options"===a.text()?this.showAdvancedAtts(a):this.hideAdvancedAtts(a)},showAdvancedAtts:function(a){var b=a.siblings(".usl-modal-advanced-atts");b.show(),a.text("Hide advanced options")},hideAdvancedAtts:function(a){var b=a.siblings(".usl-modal-advanced-atts");b.hide(),a.text("Show advanced options")},preventWindowScroll:function(){e.list.bind("mousewheel",function(b){return a(this).scrollTop(a(this).scrollTop()-b.originalEvent.wheelDeltaY),!1})},filterByCategory:function(b){var c=b.attr("data-category"),d=e.list.find("li"),f=e.list.find("li.active");this.refresh(f),"all"===c?d.show():d.each(function(){c!==a(this).attr("data-category")?a(this).hide():a(this).show()})},resetScroll:function(){e.list.scrollTop(0)},listHeight:function(){var a=e.wrap.innerHeight()-e.title.outerHeight(!0)-e.search.outerHeight(!0)-e.categories.outerHeight(!0)-e.wrap.find(".dashicons-leftright").outerHeight(!0)-e.footer.outerHeight(!0);e.list.height(a)},showRemoveButton:function(){e.remove.show()},hideRemoveButton:function(){e.remove.hide()},modify:function(a,b){"undefined"!=typeof b&&(selection=b),a=a.trim();var c=a.match(/\s.*?(?==)/g),d=a.match(/"([^"]+)"/g),e=a.match(/\[(.*?)[\s|\]]/),f=null!==e[1]?e[1].trim():"",g=a.match(/\](.*)\[/),h=null!==g?g[1]:"",i={};if(h.length&&(i.content=h),this.setActiveShortcode(f),null!==c)for(var j=0;j<c.length;j++)i[c[j].trim()]=d[j].substring(1,d[j].length-1);this.populateShortcode(i),this.open(),this.openShortcode()},setActiveShortcode:function(b){e.list.find("li").each(function(){a(this).attr("data-code")===b&&(e.active_shortcode=a(this))})},populateShortcode:function(b){e.active_shortcode.find(".usl-modal-att-row").each(function(){var c=a(this).data("attObj"),d=c.$input.attr("name");"undefined"!=typeof b[d]&&c.setValue(b[d])})},closeShortcode:function(){e.active_shortcode.length&&(e.active_shortcode.removeClass("active open"),USL_Modal.hideAdvancedAtts(e.active_shortcode.find(".usl-modal-show-advanced-atts")),USL_Modal.refresh())},openShortcode:function(){if(e.active_shortcode.length){e.active_shortcode.addClass("active"),e.active_shortcode.hasClass("accordion-section")&&e.active_shortcode.addClass("open");var a=e.active_shortcode.position(),b=e.list.scrollTop(),c=a.top+b;e.list.stop().animate({scrollTop:c})}},open:function(b){"undefined"!=typeof b&&(selection=b),f=!0,a(document).trigger("usl-modal-open"),e.wrap.show(),e.backdrop.show(),e.search.find('input[name="usl-modal-search"]').focus(),this.listHeight(),a(document).trigger("usl-modal-open")},close:function(){f=!1,e.wrap.hide(),e.backdrop.hide(),this.resetScroll(),this.closeShortcode(),this.clearSearch(),e.list.find(".usl-mce-shortcode.active").removeClass("active open"),a(document).trigger("usl-modal-close")},update:function(){var b=e.list.find("li.active");if(0!==b.length&&this.validate()){this.sanitize();var c,d,f=b.find(".usl-modal-shortcode-form").serializeArray(),g=b.attr("data-code");if(c=USL_Data.all_shortcodes[g],d="["+g,f.length)for(i=0;i<f.length;i++)"content"!==f[i].name?f[i].value.length&&(d+=" "+f[i].name+'="'+f[i].value+'"'):selection=f[i].value;d+="]",c.wrapping&&(d+=selection+"[/"+g+"]"),this.close(),this.output=d,a(document).trigger("usl-modal-update")}},validate:function(){var b=!0;return e.active_shortcode.find(".usl-modal-att-row").each(function(){var c=a(this).data("attObj"),d=c.$container.attr("data-required"),e=c.$container.attr("data-validate"),f=c.getValue(),g=!0;return"1"===d&&!f&&b?(g=!1,b=!1,c.setInvalid("This field is required"),!0):f?(e.length&&(e=USL_Modal._stringToObject(e),a.each(e,function(a,d){switch(a){case"url":var e=/[(http(s)?):\/\/(www\.)?a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/gi;f.match(e)||(g=!1,b=!1,c.setInvalid("Please enter a valid URL"));break;case"maxchar":f.length>parseInt(d)&&(g=!1,b=!1,c.setInvalid(f.length-parseInt(d)+" too many characters."));break;case"minchar":f.length<parseInt(d)&&(g=!1,b=!1,c.setInvalid(parseInt(d)-f.length+" too few characters."));break;case"charonly":f.match(/[0-9]/)&&(g=!1,b=!1,c.setInvalid("No numbers please"));break;case"intonly":var h=f.match(/[0-9]+/);h&&h[0]===h.input||(g=!1,b=!1,c.setInvalid("Only numbers please"));break;default:throw new Error('USL -> Unsupported validation method "'+a+'" for the shortcode "'+c.shortcode+'" at field "'+c.fieldname+'"')}})),void(g&&c.setValid())):!0}),b},sanitize:function(){e.active_shortcode.find(".usl-modal-att-row").each(function(){var b=USL_Modal._stringToObject(a(this).attr("data-sanitize")),c=a(this).data("attObj"),d=c.getValue();return d.length?void(b&&a.each(b,function(a){switch(a){case"url":d.match(/https?:\/\//)||c.setValue("http://"+d);break;default:throw new Error('USL -> Unsupported sanitation method "'+a+'" for the shortcode "'+c.shortcode+'" at field "'+c.fieldname+'"')}})):!0})},refresh:function(){e.active_shortcode.find(".usl-modal-att-row").each(function(){var b=a(this).data("attObj");b._revert()})},_stringToObject:function(a){return"undefined"!=typeof a&&a.length?(a='"'+a.replace(/(:|,)/g,'"$1"')+'"',a=JSON.parse("{"+a+"}")):!1}};var g=function(a){b.apply(this,arguments),this.getValue=function(){return"textarea"===this.$input.prop("tagName")?this.$input.text():this.$input.val()},this.init(a)},h=function(a){b.apply(this,arguments),this.init(a)},j=function(a){b.apply(this,arguments),this.revert=function(){this.$input.iris("color",this.original_value)},this.setValue=function(a){this.$input.iris("color",a)},this.init(a)},k=function(a){b.apply(this,arguments),this.revert=function(){this.$slider.slider("value",this.original_value)},this.setValue=function(a){this.$input.val(a),this.$slider.slider("value",a)},this.init(a),this.$slider=this.$container.find(".usl-modal-att-slider")};a(function(){USL_Modal.init()}),a(window).load(function(){USL_Modal.load()}),a(window).resize(function(){USL_Modal.resize()})}(jQuery);var USL_Widget;!function(a){var b;USL_Widget={init:function(){this.binds()},binds:function(){a(document).on("click",".usl-widget-add-shortcode",function(){USL_Widget.open(a(this))}),a(document).on("usl-modal-update",function(){USL_Widget.update()}),a(document).on("usl-modal-remove",function(){USL_Widget.remove()})},open:function(a){var b=a.closest(".widget-content"),c=b.find(".usl-widget-shortcode");"no shortcode yet"!==c.text().trim().toLowerCase()?USL_Modal.modify(c.text()):USL_Modal.open()},update:function(){b.find(".usl-widget-shortcode").text(USL_Modal.output),b.find(".usl-widget-shortcode-field").val(USL_Modal.output),b.find(".usl-widget-add-shortcode").text("Modify / Remove Shortcode")},remove:function(){USL_Modal.close(),b.find(".usl-widget-shortcode").text("No shortcode yet"),b.find(".usl-widget-shortcode-field").val(""),b.find(".usl-widget-add-shortcode").text("Add Shortcode")}},a(function(){a("body").hasClass("widgets-php")&&USL_Widget.init()})}(jQuery);
//# sourceMappingURL=ultimate-shortcodes-library-admin.min.js.map