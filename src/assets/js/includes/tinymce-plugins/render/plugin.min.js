var Render_tinymce;!function(a,b,c,d){var e=Render_Data,f=0,g=e.all_shortcodes,h=e.l18n,i=null,j=d("#render-modal-wrap").find(".render-modal-shortcodes");Render_tinymce={active_editor:null,$shortcode_content_editor:null,editing_shortcode_content_editor:null,init:function(){this.$shortcode_content_editor=d("#render-tinymce-sc-content-editor"),this.createWPView(),this.tinymceInit(),this.binds(),this.createLoaders()},createWPView:function(){var a=e.all_shortcodes||!1,f=this;a&&d.each(a,function(a,e){return c.get(a)?!0:void c.register(a,{initialize:function(){this.renderShortcode()},edit:function(a,b){var c=this;"object"==typeof a&&(a=decodeURIComponent(d(a).attr("data-wpview-text"))),this.editing=!0,f.editing=!0,Render_Modal.modify(a),d(document).on("render-modal-update",function(a,d){c.editing&&(delete c.editing,delete f.editing,b(d.all))})},renderShortcode:function(){var a=this;this.getting||(this.getting=!0,b.ajax.post("render_shortcode",{post_ID:d("#post_ID").val(),shortcode:a.buildShortcode()}).done(function(b){""===b?a.content="empty!":a.content=b}).fail(function(){a.content="error!"}).always(function(){delete a.getting,a.render(null,!0)}))},buildShortcode:function(){var a=this.shortcode,b=a.attrs.named,c=a.content,e=a.tag,f=a.type,g="["+e;return b&&d.each(b,function(a,b){!b||b.length<1||(g+=" "+a+'="'+b+'"')}),g+="]",c&&(g+=c),"closed"==f&&(g+="[/"+e+"]"),g}})})},binds:function(){d(document).on("render-modal-close",function(){}),d(document).on("render-modal-update",function(){Render_tinymce.update()}),d(document).on("render-modal-remove",function(){Render_tinymce.removeShortcode()}),d(document).on("render-tinymce-post-render",function(){Render_tinymce.postRender()}),this.$shortcode_content_editor.find(".submit").click(function(){return Render_tinymce.updateShortcodeContent(),!1}),this.$shortcode_content_editor.find(".cancel").click(function(){return Render_tinymce.closeShortcodeContentEditor(),!1}),Render_Modal.getElement("backdrop").click(function(a){null!==Render_tinymce.editing_shortcode_content_editor&&(Render_tinymce.closeShortcodeContentEditor(),a.preventDefault())})},keyboardShortcuts:function(){d(document).keyup(function(a){if(this.editing_shortcode_content_editor)switch(a.which){case 27:a.preventDefault(),Render_tinymce.closeShortcodeContentEditor()}})},editorBinds:function(a){a.on("mouseover",".render-tinymce-shortcode-wrapper:not(.hide-actions)",function(b){b.stopPropagation(),a.find(".render-tinymce-shortcode-wrapper-actions.active").removeClass("active"),d(this).find("> .render-tinymce-shortcode-wrapper-actions").addClass("active")}),a.on("mouseleave",".render-tinymce-shortcode-wrapper",function(b){b.stopPropagation(),a.find(".render-tinymce-shortcode-wrapper-actions.active:not(.hide-actions)").removeClass("active")})},tinymceInit:function(){tinymce.PluginManager.add("render",function(a){a.addButton("render_open",{icon:"render-mce-icon",cmd:"Render_Open",tooltip:h.add_shortcode}),a.addCommand("Render_Open",function(){var b,c;e.do_render?(b=a.selection.getContent({format:"html"}),c="<div>"+b+"</div>",d(c).text().trim().length&&(Render_Modal.selection=Render_tinymce.loadText(c).slice(5,Render_Modal.selection.length-6))):Render_Modal.selection=a.selection.getContent(),Render_tinymce.active_editor=a,Render_tinymce.open(null)}),a.addShortcut("alt+shift+s","","render-open"),e.do_render&&(a.addButton("render_refresh",{icon:"render-mce-refresh-icon",cmd:"Render_Refresh",tooltip:"Refresh Editor"}),a.addCommand("Render_Refresh",function(){Render_tinymce.active_editor=a,Render_tinymce.loadVisual()}))})},editShortcodeContent:function(){this.editing_shortcode_content_editor=this.active_editor;var a=d(this.editing_shortcode_content_editor.getBody()).find(".render-tinymce-editing-content"),b=d("<div />"),c=a.find(".render-tinymce-shortcode-content").html();b.append(c),b.find(".render-tinymce-shortcode-placeholder").remove(),c=b.html(),this.openShortcodeContentEditor(a,c)},updateShortcodeContent:function(){var a=tinymce.get("render-tinymce-shortcode-content"),b=a.getContent(),c=d(this.editing_shortcode_content_editor.getBody()).find(".render-tinymce-editing-content"),f=c.data("code");g[f].render&&g[f].render.displayInline&&(b=b.replace(new RegExp(e.block_regex,"gi"),"")),c.find(".render-tinymce-shortcode-content").html(b),this.closeShortcodeContentEditor(),e.do_render?this.loadVisual():c.removeClass("render-tinymce-editing-content")},closeShortcodeContentEditor:function(){var a=d(this.editing_shortcode_content_editor.getBody()).find(".render-tinymce-editing-content");a.removeClass("render-tinymce-editing-content"),this.$shortcode_content_editor.hide().removeClass("active"),this.loading(!1,this.editing_shortcode_content_editor),this.editing_shortcode_content_editor.focus(),Render_Modal.getElement("backdrop").hide(),Render_Modal.keepBackdrop=!1,this.active_editor=this.editing_shortcode_content_editor,this.editing_shortcode_content_editor=null},openShortcodeContentEditor:function(b,c){tinymce.EditorManager.execCommand("mceRemoveEditor",!0,"render-tinymce-shortcode-content"),Render_Modal.getElement("backdrop").show(),Render_Modal.keepBackdrop=!0,this.loading(!0,this.editing_shortcode_content_editor),this.$shortcode_content_editor.find(".render-tinymce-sc-content-editor-title-sc-name").html(b.data("name")),this.$shortcode_content_editor.data({name:b.data("name"),code:b.data("code")});var e=d(a).width()<500?.9*d(a).width():500,f=d(a).height()<600?.9*d(a).height():600,g=e/2*-1,h=f/2*-1,i=d(this.editing_shortcode_content_editor.getContainer()),j=b.offset().left+b.width()/2+i.offset().left,k=b.offset().top+b.height()/2+i.offset().top,l=300,m=d(a).scrollTop();m&&(k-=m),this.$shortcode_content_editor.css({width:e,height:f,marginLeft:g,marginTop:h,left:j,top:k}),this.$shortcode_content_editor.show().delay(100).animate({left:"50%",top:"50%"},l),this.$shortcode_content_editor.find(".render-tinymce-sc-content-editor-container").hide().show("scale",{origin:["middle","center"],percent:100,scale:"box",complete:function(){setTimeout(function(){var a=Render_tinymce.$shortcode_content_editor;a.addClass("active"),tinymce.EditorManager.execCommand("mceAddEditor",!0,"render-tinymce-shortcode-content");var b=tinymce.get("render-tinymce-shortcode-content");b.setContent(c);var e=d("#wp-render-tinymce-shortcode-content-wrap");e.find(".mce-edit-area").css("height",a.height()-(e.height()-e.find(".mce-edit-area").height())-a.find(".render-tinymce-sc-content-editor-actions").outerHeight(!0)-a.find(".render-tinymce-sc-content-editor-title").outerHeight(!0)),Render_tinymce.active_editor.focus()},1)}},l)},showSCEditorError:function(a,b){var c=this.$shortcode_content_editor.find(".render-tinymce-sc-content-editor-error");b=b||3e3,c.html(a).addClass("show"),null!==i&&(clearTimeout(i),c.effect("shake",{distance:10,times:2},200)),i=setTimeout(function(){c.removeClass("show"),i=null},b)},createLoaders:function(){d(".wp-editor-container").append('<div class="render-tinymce-loader hide"><div class="spinner"></div><div class="text">></div></div>')},loadVisual:function(){var a=Render_tinymce.active_editor.getContent();a=Render_tinymce.loadText(a),Render_tinymce.convertLiteralToRendered(a)},postRender:function(){},loadText:function(a){return a=Render_tinymce.convertRenderedToLiteral(a)},visualToLiteral:function(a){var b=d(a).data("code"),c=d(a).data("atts"),e=d(a).find(".render-tinymce-shortcode-content").html(),f="["+b;return c&&(c=JSON.parse(c),d.each(c,function(a,b){b.length&&(f+=" "+a+"='"+b+"'")})),f+="]",e&&(f+=e+"[/"+b+"]"),f},open:function(a,b){if("undefined"!=typeof a&&null!==a&&Render_Modal.modify(a),Render_Modal.selection||j.find(".render-modal-shortcode.wrapping:not(.nested-parent)").each(function(){Render_Modal.disableShortcode(d(this),h.select_content_from_editor)}),this.editing_shortcode_content_editor){var c=this.$shortcode_content_editor.data("code");j.find('.render-modal-shortcode[data-code="'+c+'"]').each(function(){Render_Modal.disableShortcode(d(this),h.cannot_nest_identical)})}var e=d(Render_tinymce.active_editor.selection.getNode()),f=e.length?e.closest(".nested-child"):!1;if(f.length){var g=f.parent().closest(".render-tinymce-shortcode-wrapper").data("code");j.find('.render-modal-shortcode[data-code="'+g+'"]').each(function(){Render_Modal.disableShortcode(d(this),h.cannot_place_shortcode_here)})}Render_Modal.open()},close:function(){d(this.active_editor.dom.select(".render-tinymce-editing")).removeClass("render-tinymce-editing"),this.active_editor.focus()},update:function(){this.editing||this.active_editor.insertContent(Render_Modal.output.all)},removeShortcode:function(){var a=d("<div />").append(d(Render_tinymce.active_editor.getBody()).html()),b=a.find(".render-tinymce-editing"),c=b.find(".render-tinymce-shortcode-content"),e=g[b.data("code")].render,f="undefined"!=typeof e&&"undefined"!=typeof e.nested,h=c.length?c.contents():"",i=!1;if(f){var j;h="",c.children(".render-tinymce-shortcode-wrapper.nested-child").each(function(){d(this).find(".render-tinymce-shortcode-content").first().each(function(){i=!0,j=Render_tinymce.loadText(d("<div />").append(d(this).contents()).html()),h=""===h?d("<p />").append(j):h.add(d("<p />").append(j))})})}b.replaceWith(h),this.active_editor.setContent(a.html()),Render_Modal.close(),i&&this.loadVisual()},loading:function(a,b){b=b||Render_tinymce.active_editor;var c=d(b.getContainer()).closest(".wp-editor-wrap"),g=c.find(".render-tinymce-loader");if(a){var h=e.loading_messages,i=Math.floor(Math.random()*h.length);if(i==f)for(;i==f;)i=Math.floor(Math.random()*h.length);f=i,g.find(".text").html(h[i]),g.removeClass("hide"),c.find(".switch-html").prop("disabled",!0),c.find(".switch-tmce").prop("disabled",!0),c.find(".wp-media-buttons").addClass("disabled")}else g.addClass("hide"),c.find(".switch-html").prop("disabled",!1),c.find(".switch-tmce").prop("disabled",!1),c.find(".wp-media-buttons").removeClass("disabled")},getEditor:function(){return this.active_editor},convertLiteralToRendered:function(a){Render_tinymce.loading(!0);var b;"undefined"!=typeof e.render_data&&(b=e.render_data),b.action="render_render_shortcodes",b.content=a,b.shortcode_data=e.rendered_shortcodes,b.editor_id=this.active_editor.id,d.ajax({url:ajaxurl,method:"POST",data:b,editor:this.active_editor,success:function(a){Render_tinymce.active_editor=this.editor,Render_tinymce.active_editor.setContent(a),d(Render_tinymce.active_editor.getBody()).find(".no-js").css("display","none"),Render_tinymce.loading(!1),d(document).trigger("render-tinymce-post-render")}})},convertRenderedToLiteral:function(a){var b=d("<div />").append(a);b.find(".render-tinymce-dummy-container").each(function(){d(this).replaceWith(this.childNodes)}),b.find(".render-tinymce-shortcode-placeholder").remove();var c=b.find(".render-tinymce-shortcode-wrapper").sortByDepth();return c.each(function(){var a=d(this).data("atts"),b=d(this).data("code"),c=d(this).find(".render-tinymce-shortcode-content").first().html(),e="["+b;if(a){"object"!=typeof a&&(a=JSON.parse(a));var f="";d.each(a,function(a,b){f+=" "+a+"='"+b+"'"}),e+=f}e+="]",g[b].wrapping&&(e+=(c||"")+"[/"+b+"]"),d(this).replaceWith(e)}),b.html()}},d(function(){Render_tinymce.init()}),a.RenderRefreshTinyMCE=function(){Render_tinymce.loadVisual()}}(window,window.wp,window.wp.mce.views,window.jQuery);
//# sourceMappingURL=plugin.min.js.map