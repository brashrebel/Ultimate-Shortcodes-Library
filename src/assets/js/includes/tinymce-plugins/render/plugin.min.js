var Render_tinymce;!function(a){var b,c,d,e,f=!1,g=0,h=!1,i=a("#render-modal-wrap").find(".render-modal-shortcodes");Render_tinymce={init:function(){this.addToTinymce(),this.binds(),d=a("#wp-content-editor-container"),c=d.find(".wp-editor-area"),this.createLoader()},binds:function(){a(document).on("render-modal-close",function(){Render_tinymce.close()}),a(document).on("render-modal-update",function(){Render_tinymce.update()}),a(document).on("render-modal-remove",function(){Render_tinymce.removeShortcode()}),a(document).on("render-tinymce-post-render",function(){Render_tinymce.postRender()}),a("#post").submit(function(b){Render_tinymce.submit(b,a(this))})},editorBinds:function(b){b.on("mouseover",".render-tinymce-shortcode-wrapper:not(.hide-actions)",function(c){c.stopPropagation(),b.find(".render-tinymce-shortcode-wrapper-actions.active").removeClass("active"),a(this).find("> .render-tinymce-shortcode-wrapper-actions").addClass("active")}),b.on("mouseleave",".render-tinymce-shortcode-wrapper",function(a){a.stopPropagation(),b.find(".render-tinymce-shortcode-wrapper-actions.active:not(.hide-actions)").removeClass("active")})},addToTinymce:function(){tinymce.PluginManager.add("render",function(d){if("content"===d.id){var e;b=d,d.addButton("render_open",{icon:"render-mce-icon",cmd:"Render_Open",tooltip:"Add Shortcode"}),d.addCommand("Render_Open",function(){var c,d;Render_Data.do_render?(c=b.selection.getContent({format:"html"}),d="<div>"+c+"</div>",a(d).text().trim().length&&(Render_Modal.selection=Render_tinymce.loadText(d).slice(5,Render_Modal.selection.length-6))):Render_Modal.selection=b.selection.getContent(),Render_tinymce.open()}),d.addShortcut("alt+shift+s","","render-open"),Render_Data.do_render&&(d.addButton("render_refresh",{icon:"render-mce-refresh-icon",cmd:"Render_Refresh",tooltip:"Refresh Editor"}),d.addCommand("Render_Refresh",function(){Render_tinymce.loadVisual()}),d.onClick.add(function(b,c){var d,f,g,h;e=a(b.getBody()),e.find(".render-tinymce-shortcode-wrapper.delete").removeClass("delete"),a(c.target).hasClass("render-tinymce-shortcode-wrapper-edit")&&(d=a(c.target).closest(".render-tinymce-shortcode-wrapper"),f=d.find(".render-tinymce-shortcode-content").html(),g=a("<div />").append(d.clone()).html(),h=Render_tinymce.visualToLiteral(g),f&&f.length&&(Render_Modal.selection=f),d.addClass("render-tinymce-editing"),Render_tinymce.open(h)),a(c.target).hasClass("render-tinymce-shortcode-wrapper-remove")&&(d=a(c.target).closest(".render-tinymce-shortcode-wrapper"),b.dom.remove(d[0]))}),d.onKeyPress.add(function(b,c){var d=b.selection.getNode(),e=a(d).html();if(!d||a(d).hasClass("render-tinymce-shortcode-content")){var f=b.selection.getRng().startContainer,g=b.selection.getBookmark(f.textContent).rng;if("undefined"!=typeof g){var h=g.startOffset,i=(0!=h?e.slice(h-1,h):"",a("<div />").html(e).text());if(h===i.length){var j=String.fromCharCode(c.charCode);" "===j&&(j="&nbsp;"),c.preventDefault(),a(d).html(i+j),b.selection.select(d,!0),b.selection.collapse(!1)}}}}),d.on("init",function(){Render_tinymce.editorBinds(a(b.getBody()))}),d.on("init show",Render_tinymce.loadVisual),d.on("hide",function(){var a=b.getContent({format:"numeric"});c.val(window.switchEditors.pre_wpautop(Render_tinymce.loadText(a)))}),b.on("BeforeAddUndo",function(a){var b,c,d=Render_Data.shortcode_regex.match(/\((\w+\|?)+\)/);d&&(b=new RegExp("\\["+d[0],"g"),a.level.content.length&&(c=a.level.content.match(b))),c&&a.preventDefault()}))}})},createLoader:function(){d.append('<div id="render-tinymce-loader" class="hide"><div class="spinner"></div><div class="text">></div></div>'),e=a("#render-tinymce-loader")},loadVisual:function(){var a=b.getContent();a=Render_tinymce.loadText(a),Render_tinymce.convertLiteralToRendered(a,b)},postRender:function(){var c=a(b.getBody());c.find(".render-tinymce-shortcode-wrapper").each(function(){var b=a(this).parent().contents();if(b[b.length-1]==a(this).get(0)){var c=a(this).prop("tagName").toLowerCase(),d=a("<"+c+' class="render-tinymce-dummy-container">&#8203;</'+c+">");a(this).after(d)}})},loadText:function(a){return a=a.replace(/&#8203;/g,""),a=Render_tinymce.convertRenderedToLiteral(a)},visualToLiteral:function(b){var c=a(b).attr("data-code"),d=a(b).attr("data-atts"),e=a(b).find(".render-tinymce-shortcode-content").html(),f="["+c;return d&&(d=JSON.parse(d),a.each(d,function(a,b){b.length&&(f+=" "+a+"='"+b+"'")})),f+="]",e&&(f+=e+"[/"+c+"]"),f},open:function(c){i.find(".render-modal-shortcode.wrapping.disabled").removeClass("disabled"),"undefined"!=typeof c?Render_Modal.modify(c):(Render_Modal.selection||i.find(".render-modal-shortcode.wrapping:not(.nested-parent)").addClass("disabled").data("shortcodeErrorMessage","Please select content from the editor to enable this shortcode."),Render_Modal.open());var d=a(b.selection.getNode()),e=d.length?d.closest(".nested-child"):!1;if(e.length){var f=e.parent().closest(".render-tinymce-shortcode-wrapper").data("code");i.find('.render-modal-shortcode[data-code="'+f+'"]').addClass("disabled").data("shortcodeErrorMessage","You cannot place this shortcode here.")}},close:function(){b.focus()},update:function(){var c=a(b.dom.select(".render-tinymce-editing"));c.length?c.replaceWith(Render_Modal.output.all):b.selection.getContent().length?b.selection.setContent(Render_Modal.output.all):b.insertContent(Render_Modal.output.all),Render_Data.do_render&&this.loadVisual()},removeShortcode:function(){var c=b.selection.getNode(),d=a(c).hasClass("render-tinymce-shortcode-wrapper")?a(c):a(c).closest(".render-tinymce-shortcode-wrapper");b.dom.remove(d[0]),Render_Modal.close()},loading:function(b){function c(){return f?void setTimeout(c,50):(e.addClass("hide"),a("#content-html").prop("disabled",!1),a("#content-tmce").prop("disabled",!1),void a("#wp-content-media-buttons").removeClass("disabled"))}if(b){f=!0,setTimeout(function(){f=!1},1e3);var d=Render_Data.loading_messages,h=Math.floor(Math.random()*d.length);if(h==g)for(;h==g;)h=Math.floor(Math.random()*d.length);g=h,e.find(".text").html(d[h]),e.removeClass("hide"),a("#content-html").prop("disabled",!0),a("#content-tmce").prop("disabled",!0),a("#wp-content-media-buttons").addClass("disabled")}else c()},submit:function(a,c){if(!h){h=!0,a.preventDefault();var d=b.getContent();b.on("PostProcess",function(a){a.content=Render_tinymce.loadText(d)}),c.submit()}},getEditor:function(){return b},convertLiteralToRendered:function(b,c){Render_tinymce.loading(!0);var d;"undefined"!=typeof Render_Data.render_data&&(d=Render_Data.render_data),d.action="render_render_shortcodes",d.content=b,d.shortcode_data=Render_Data.rendered_shortcodes,a.post(ajaxurl,d,function(b){c.setContent(b),a(c.getBody()).find(".no-js").css("display","none"),Render_tinymce.loading(!1),a(document).trigger("render-tinymce-post-render")})},convertRenderedToLiteral:function(b){var c=a("<div />").append(a(b));c.find(".render-tinymce-dummy-container").each(function(){a(this).replaceWith(this.childNodes)});var d=c.find(".render-tinymce-shortcode-wrapper").sortByDepth();return d.each(function(){var b=a(this).attr("data-atts"),c=a(this).attr("data-code"),d=a(this).find(".render-tinymce-shortcode-content").first().html(),e="["+c;if(b){b=JSON.parse(b);var f="";a.each(b,function(a,b){f+=" "+a+"='"+b+"'"}),e+=f}e+="]",d&&(e+=d+"[/"+c+"]"),a(this).replaceWith(e)}),c.html()}},a(function(){Render_tinymce.init()}),window.RenderRefreshTinyMCE=function(){Render_tinymce.loadVisual()}}(jQuery);
//# sourceMappingURL=plugin.min.js.map