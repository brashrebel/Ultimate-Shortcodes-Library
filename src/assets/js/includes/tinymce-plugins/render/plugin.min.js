var Render_tinymce;!function(a){var b=Render_Data,c=!1,d=0,e=b.all_shortcodes,f=b.l18n,g=null,h=a("#ender-modal-wrap").find(".render-modal-shortcodes"),i=[];Render_tinymce={active_editor:null,$shortcode_content_editor:null,editing_shortcode_content_editor:null,init:function(){this.$shortcode_content_editor=a("#render-tinymce-sc-content-editor"),this.addToTinymce(),this.binds(),this.keyboardShortcuts(),this.createLoaders()},binds:function(){a(document).on("render-modal-close",function(){Render_tinymce.close()}),a(document).on("render-modal-update",function(){Render_tinymce.update()}),a(document).on("render-modal-remove",function(){Render_tinymce.removeShortcode()}),a(document).on("render-tinymce-post-render",function(){Render_tinymce.postRender()}),this.$shortcode_content_editor.find(".submit").click(function(){return Render_tinymce.updateShortcodeContent(),!1}),this.$shortcode_content_editor.find(".cancel").click(function(){return Render_tinymce.closeShortcodeContentEditor(),!1}),Render_Modal.getElement("backdrop").click(function(a){null!==Render_tinymce.editing_shortcode_content_editor&&(Render_tinymce.closeShortcodeContentEditor(),a.preventDefault())})},keyboardShortcuts:function(){a(document).keyup(function(a){if(null!==this.editing_shortcode_content_editor)switch(a.which){case 27:a.preventDefault(),Render_tinymce.closeShortcodeContentEditor()}})},editorBinds:function(b){b.on("mouseover",".render-tinymce-shortcode-wrapper:not(.hide-actions)",function(c){c.stopPropagation(),b.find(".render-tinymce-shortcode-wrapper-actions.active").removeClass("active"),a(this).find("> .render-tinymce-shortcode-wrapper-actions").addClass("active")}),b.on("mouseleave",".render-tinymce-shortcode-wrapper",function(a){a.stopPropagation(),b.find(".render-tinymce-shortcode-wrapper-actions.active:not(.hide-actions)").removeClass("active")})},addToTinymce:function(){tinymce.PluginManager.add("render",function(c){c.addButton("render_open",{icon:"render-mce-icon",cmd:"Render_Open",tooltip:f.add_shortcode}),c.addCommand("Render_Open",function(){var d,e;b.do_render?(d=c.selection.getContent({format:"html"}),e="<div>"+d+"</div>",a(e).text().trim().length&&(Render_Modal.selection=Render_tinymce.loadText(e).slice(5,Render_Modal.selection.length-6))):Render_Modal.selection=c.selection.getContent(),Render_tinymce.active_editor=c,Render_tinymce.open(null)}),c.addShortcut("alt+shift+s","","render-open"),b.do_render&&(c.addButton("render_refresh",{icon:"render-mce-refresh-icon",cmd:"Render_Refresh",tooltip:"Refresh Editor"}),c.addCommand("Render_Refresh",function(){Render_tinymce.active_editor=c,Render_tinymce.loadVisual()}),c.onKeyDown.add(function(b,c){c=c||event,i[c.keyCode]=!0,a(document).trigger("render-tinymce-key-tracker",[b,c])}),c.onKeyUp.add(function(b,c){c=c||event,delete i[c.keyCode],a(document).trigger("render-tinymce-key-tracker",[b,c])}),c.onClick.add(function(c,d){Render_tinymce.active_editor=c;var e,f,h,i=a(d.target).closest(".render-tinymce-shortcode-wrapper");if(a(d.target).hasClass("render-tinymce-shortcode-wrapper-edit"))e=i.find(".render-tinymce-shortcode-content").html(),f=a("<div />").append(i.clone()).html(),h=Render_tinymce.convertRenderedToLiteral(f),e&&e.length&&(Render_Modal.selection=e),i.addClass("render-tinymce-editing"),Render_tinymce.open(h);else if(a(d.target).hasClass("render-tinymce-shortcode-wrapper-remove"))a(d.target).closest(".render-tinymce-shortcode-wrapper").addClass("render-tinymce-editing"),Render_tinymce.removeShortcode();else if(!i.find(".nested-child").length&&i.length&&i.find(".render-tinymce-shortcode-content").length){if("render-tinymce-shortcode-content"==c.id){var j=b.l18n.cannot_edit_sc_content,k=null;return null!==g&&(j=b.l18n.cannot_edit_sc_content_detail,k=6e3),j=j.replace(/\{shortcode1}/g,Render_tinymce.$shortcode_content_editor.data("name")),j=j.replace(/\{shortcode2}/g,i.data("name")),void Render_tinymce.showSCEditorError(j,k)}i.addClass("render-tinymce-editing-content"),Render_tinymce.editShortcodeContent()}}),a(document).on("render-tinymce-key-tracker",function(){if(i[13]||i[8]||i[46]||(i[17]||i[91])&&i[86]||(i[17]||i[91])&&i[88]){var b=a(Render_tinymce.active_editor.selection.getNode()),c=b.parents(".render-tinymce-shortcode-wrapper").last();c.length||(c=b.closest(".render-tinymce-shortcode-wrapper")),c.length&&Render_tinymce.active_editor.dom.remove(c.get(0))}}),c.onKeyDown.add(function(b,c){var d=a(b.selection.getNode()),e=d.prev(".render-tinymce-shortcode-wrapper"),f=d.next(".render-tinymce-shortcode-wrapper"),g=b.selection.getRng().startOffset;return 8==c.which&&0===g&&e?(d.text().length||(console.log("above!"),b.dom.remove(d.get(0))),c.preventDefault(),!1):46==c.which&&g===d.text().length&&f?(d.text().length||(console.log("below!"),b.dom.remove(d.get(0))),c.preventDefault(),!1):void 0}),c.on("click",function(b){var d=b.clientX,e=b.clientY,f=a(c.getBody()),g=f.contents().first().filter(".render-tinymce-shortcode-wrapper"),h=f.contents().last().filter(".render-tinymce-shortcode-wrapper");if(g.length&&e<g.offset().top){var i=a("<p />").append("&nbsp;");f.prepend(i),c.nodeChanged(),c.selection.select(i.get(0)),c.selection.collapse(!0),b.preventDefault()}else if(h.length&&e>h.offset().top+h.height()){var j=a("<p />").append("&nbsp;");f.append(j),c.nodeChanged(),c.selection.select(j.get(0)),c.selection.collapse(!0),b.preventDefault()}else{var k=a(b.target),l=k.contents().last().filter(".render-tinymce-shortcode-wrapper"),m=k.contents().first().filter(".render-tinymce-shortcode-wrapper");m.length&&d<m.offset().left?(m.before("&nbsp;"),c.nodeChanged(),c.selection.select(k.get(0)),c.selection.collapse(),b.preventDefault()):l.length&&d>l.offset().left+l.width()&&(b.preventDefault(),l.after("&nbsp;"),c.nodeChanged(),c.selection.select(k.get(0)),c.selection.collapse(!1))}}),c.on("nodechange",function(b){if(Render_tinymce.active_editor=c,"IMG"==b.element.nodeName){var d,f,g=a(b.element),h=g.closest(".render-tinymce-shortcode-wrapper"),i=a(c.getBody());h.length&&(d=e[h.data("code")].render,("undefined"==typeof d||"undefined"==typeof d.allowImageEditing)&&setTimeout(function(){f=i.find(".mce-resizehandle"),f.hide()},1))}}),c.on("init",function(){Render_tinymce.active_editor=c,Render_tinymce.editorBinds(a(c.getBody()))}),c.on("init show",function(){setTimeout(function(){Render_tinymce.active_editor=c,Render_tinymce.loadVisual()},1)}),c.on("PostProcess",function(a){a.content=Render_tinymce.loadText(a.content)}),c.on("BeforeAddUndo",function(b){if(e){var c="\\[(",d=!1;a.each(e,function(a){c+=a+"|"}),c=new RegExp(c.substring(0,c.length-1)+")"),b.level.content.length&&(d=b.level.content.match(c)),d&&b.preventDefault()}}))})},editShortcodeContent:function(){this.editing_shortcode_content_editor=this.active_editor;var b=a(this.editing_shortcode_content_editor.getBody()).find(".render-tinymce-editing-content"),c=a("<div />"),d=b.find(".render-tinymce-shortcode-content").html();c.append(d),c.find(".render-tinymce-shortcode-placeholder").remove(),d=c.html(),this.openShortcodeContentEditor(b,d)},updateShortcodeContent:function(){var c=tinymce.get("render-tinymce-shortcode-content"),d=c.getContent(),f=a(this.editing_shortcode_content_editor.getBody()).find(".render-tinymce-editing-content"),g=f.data("code");e[g].render&&e[g].render.displayInline&&(d=d.replace(new RegExp(b.block_regex,"gi"),"")),f.find(".render-tinymce-shortcode-content").html(d),this.closeShortcodeContentEditor(),b.do_render?this.loadVisual():f.removeClass("render-tinymce-editing-content")},closeShortcodeContentEditor:function(){var b=a(this.editing_shortcode_content_editor.getBody()).find(".render-tinymce-editing-content");b.removeClass("render-tinymce-editing-content"),this.$shortcode_content_editor.hide().removeClass("active"),Render_Modal.getElement("backdrop").hide(),Render_Modal.keepBackdrop=!1,this.active_editor=this.editing_shortcode_content_editor,this.editing_shortcode_content_editor=null},openShortcodeContentEditor:function(b,c){tinymce.EditorManager.execCommand("mceRemoveEditor",!0,"render-tinymce-shortcode-content"),Render_Modal.getElement("backdrop").show(),Render_Modal.keepBackdrop=!0,this.$shortcode_content_editor.find(".render-tinymce-sc-content-editor-title-sc-name").html(b.data("name")),this.$shortcode_content_editor.data("name",b.data("name"));var d=a(window).width()<500?.9*a(window).width():500,e=a(window).height()<600?.9*a(window).height():600,f=d/2*-1,g=e/2*-1,h=a(this.editing_shortcode_content_editor.getContainer()),i=b.offset().left+b.width()/2+h.offset().left,j=b.offset().top+b.height()/2+h.offset().top,k=300,l=a(window).scrollTop();l&&(j-=l),this.$shortcode_content_editor.css({width:d,height:e,marginLeft:f,marginTop:g,left:i,top:j}),this.$shortcode_content_editor.show().delay(100).animate({left:"50%",top:"50%"},k),this.$shortcode_content_editor.find(".render-tinymce-sc-content-editor-container").hide().show("scale",{origin:["middle","center"],percent:100,scale:"box",complete:function(){setTimeout(function(){var b=Render_tinymce.$shortcode_content_editor;b.addClass("active"),tinymce.EditorManager.execCommand("mceAddEditor",!0,"render-tinymce-shortcode-content");var d=tinymce.get("render-tinymce-shortcode-content");d.setContent(c);var e=a("#wp-render-tinymce-shortcode-content-wrap");e.find(".mce-edit-area").css("height",b.height()-(e.height()-e.find(".mce-edit-area").height())-b.find(".render-tinymce-sc-content-editor-actions").outerHeight(!0)-b.find(".render-tinymce-sc-content-editor-title").outerHeight(!0))},1)}},k)},showSCEditorError:function(a,b){var c=this.$shortcode_content_editor.find(".render-tinymce-sc-content-editor-error");b=b||3e3,c.html(a).addClass("show"),null!==g&&(clearTimeout(g),c.effect("shake",{distance:10,times:2},200)),g=setTimeout(function(){c.removeClass("show"),g=null},b)},createLoaders:function(){a(".wp-editor-container").append('<div class="render-tinymce-loader hide"><div class="spinner"></div><div class="text">></div></div>')},loadVisual:function(){var a=Render_tinymce.active_editor.getContent();a=Render_tinymce.loadText(a),Render_tinymce.convertLiteralToRendered(a)},postRender:function(){},loadText:function(a){return a=Render_tinymce.convertRenderedToLiteral(a)},visualToLiteral:function(b){var c=a(b).data("code"),d=a(b).data("atts"),e=a(b).find(".render-tinymce-shortcode-content").html(),f="["+c;return d&&(d=JSON.parse(d),a.each(d,function(a,b){b.length&&(f+=" "+a+"='"+b+"'")})),f+="]",e&&(f+=e+"[/"+c+"]"),f},open:function(b){"undefined"!=typeof b&&null!==b?Render_Modal.modify(b):(Render_Modal.selection||h.find(".render-modal-shortcode.wrapping:not(.nested-parent)").each(function(){Render_Modal.disableShortcode(a(this),f.select_content_from_editor)}),Render_Modal.open());var c=a(Render_tinymce.active_editor.selection.getNode()),d=c.length?c.closest(".nested-child"):!1;if(d.length){var e=d.parent().closest(".render-tinymce-shortcode-wrapper").data("code");h.find('.render-modal-shortcode[data-code="'+e+'"]').each(function(){Render_Modal.disableShortcode(a(this),f.cannot_place_shortcode_here)})}},close:function(){this.active_editor.focus()},update:function(){var c=a(this.active_editor.dom.select(".render-tinymce-editing"));c.length&&this.active_editor.selection.select(c.get(0)),this.active_editor.selection.getContent().length?this.active_editor.selection.setContent(Render_Modal.output.all):this.active_editor.insertContent(Render_Modal.output.all),b.do_render&&this.loadVisual()},removeShortcode:function(){var b=a("<div />").append(a(Render_tinymce.active_editor.getBody()).html()),c=b.find(".render-tinymce-editing"),d=c.find(".render-tinymce-shortcode-content"),f=e[c.data("code")].render,g="undefined"!=typeof f&&"undefined"!=typeof f.nested,h=d.length?d.contents():"";if(g){var i;h="",d.children(".render-tinymce-shortcode-wrapper.nested-child").each(function(){a(this).find(".render-tinymce-shortcode-content").first().each(function(){i=Render_tinymce.loadText(a("<div />").append(a(this).contents()).html()),h=""===h?a("<p />").append(i):h.add(a("<p />").append(i))})})}c.replaceWith(h),this.active_editor.setContent(b.html()),Render_Modal.close(),this.loadVisual()},loading:function(e){var f=a(Render_tinymce.active_editor.getContainer()).closest(".wp-editor-wrap"),g=f.find(".render-tinymce-loader");if(e){c=!0,setTimeout(function(){c=!1},1e3);var h=b.loading_messages,i=Math.floor(Math.random()*h.length);if(i==d)for(;i==d;)i=Math.floor(Math.random()*h.length);d=i,g.find(".text").html(h[i]),g.removeClass("hide"),f.find(".switch-html").prop("disabled",!0),f.find(".switch-tmce").prop("disabled",!0),f.find(".wp-media-buttons").addClass("disabled")}else g.addClass("hide"),f.find(".switch-html").prop("disabled",!1),f.find(".switch-tmce").prop("disabled",!1),f.find(".wp-media-buttons").removeClass("disabled")},getEditor:function(){return this.active_editor},convertLiteralToRendered:function(c){Render_tinymce.loading(!0);var d;"undefined"!=typeof b.render_data&&(d=b.render_data),d.action="render_render_shortcodes",d.content=c,d.shortcode_data=b.rendered_shortcodes,d.editor_id=this.active_editor.id,a.ajax({url:ajaxurl,method:"POST",data:d,editor:this.active_editor,success:function(b){Render_tinymce.active_editor=this.editor,Render_tinymce.active_editor.setContent(b),a(Render_tinymce.active_editor.getBody()).find(".no-js").css("display","none"),Render_tinymce.loading(!1),a(document).trigger("render-tinymce-post-render")}})},convertRenderedToLiteral:function(b){var c=a("<div />").append(b);c.find(".render-tinymce-dummy-container").each(function(){a(this).replaceWith(this.childNodes)}),c.find(".render-tinymce-shortcode-placeholder").remove();var d=c.find(".render-tinymce-shortcode-wrapper").sortByDepth();return d.each(function(){var b=a(this).data("atts"),c=a(this).data("code"),d=a(this).find(".render-tinymce-shortcode-content").first().html(),f="["+c;if(b){"object"!=typeof b&&(b=JSON.parse(b));var g="";a.each(b,function(a,b){g+=" "+a+"='"+b+"'"}),f+=g}f+="]",e[c].wrapping&&(f+=(d||"")+"[/"+c+"]"),a(this).replaceWith(f)}),c.html()}},a(function(){Render_tinymce.init()}),window.RenderRefreshTinyMCE=function(){Render_tinymce.loadVisual()}}(jQuery);
//# sourceMappingURL=plugin.min.js.map