var USL_Admin;!function(a){USL_Admin={init:function(){}},a(function(){USL_Admin.init()})}(jQuery);var USL_MCECallbacks;!function(a){var b;USL_MCECallbacks={visualLoadCounter:{count:0,total:0},preShortcode:function(b,c,d,e,f){d=d?d:"span",e=e?e:"",f="undefined"==typeof f?!1:f;var g="",h='<span class="usl-tinymce-shortcode-code" data-code="'+b+'"></span>';return e+=f?"":"styled",c&&(g+='<span class="usl-tinymce-shortcode-atts" data-atts=\'',a.each(c,function(a,b){g+='"'+a+'": "'+b+'", '}),g+="'></span>"),"<"+d+' class="usl-tinymce-shortcode-wrapper '+b+" "+e+'">'+g+h},postShortcode:function(a){return a="undefined"==typeof a?"span":a,'<span class="usl-tinymce-shortcode-wrapper-end"></span></'+a+">&#8203;"},convertLiteralToRendered:function(c,d){b=d;var e=new RegExp("\\[.*?](.*?\\[\\/.*?])?","gi"),f=c.match(e);if(f){USL_tinymce.loading(!0),this.visualLoadCounter.total=f.length,this.visualLoadCounter.count=0;for(var g=0;g<f.length;g++){var h=f[g],i=this.getLiteralAtts(h),j=f[g].match(/\[(.*?)(?=\s|])/),k=j?j[1]:!1,l=this.getLiteralContent(h),m={};if(k)if(k in USL_Data.all_shortcodes)if(k in USL_Data.rendered_shortcodes)"undefined"!=typeof USL_Data.render_data&&(m=USL_Data.render_data),m.action="usl_render_shortcode",m.shortcode=h,m.atts=i,m.code=k,m.total=f.length,a.post(ajaxurl,m,function(a){var c=a.shortcode,d=b.getContent(),e="";if(c=c.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),c=new RegExp(c,"g"),"undefined"==typeof a.output)return console.log(a),e+=USL_MCECallbacks.preShortcode("error"),e+="error",e+=USL_MCECallbacks.postShortcode(),b.setContent(d.replace(c,e)),void USL_MCECallbacks.updateCounter();var f=USL_Data.rendered_shortcodes[a.code].displayBlock?"div":"span",g=USL_Data.rendered_shortcodes[a.code].classes?USL_Data.rendered_shortcodes[a.code].classes:"",h=USL_Data.rendered_shortcodes[a.code].noStyle?USL_Data.rendered_shortcodes[a.code].noStyle:"";e+=USL_MCECallbacks.preShortcode(a.code,a.atts,f,g,h),e+=a.output,e+=USL_MCECallbacks.postShortcode(f),b.setContent(d.replace(c,e)),USL_MCECallbacks.updateCounter()});else{var n="",o=b.getContent(),p=h.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");p=new RegExp(p,"g"),n+=USL_MCECallbacks.preShortcode(k),n+=k,n+=l?' - "<span class="usl-tinymce-shortcode-content">'+l+'</span>"':"",n+=USL_MCECallbacks.postShortcode(),b.setContent(o.replace(p,n)),this.updateCounter()}else this.updateCounter();else this.updateCounter()}}},convertRenderedToLiteral:function(b){var c=new RegExp('<(span|div)\\s*?class="usl-tinymce-shortcode-wrapper.*?(data-atts="(.*?)")?.*?data-code="(.*?)".*?(<span class="usl-tinymce-shortcode-content">(.*?)<\\/span>)?.*?usl-tinymce-shortcode-wrapper-end"><\\/span><\\/(span|div)>',"gi"),d=b.match(c);if(!d)return b;for(var e=0;e<d.length;e++){var f=d[e],g=this.getVisualAtts(d[e]),h=this.getVisualContent(d[e]),i=this.getVisualCode(d[e]),j="["+i;g&&a.each(g,function(a,b){j+=" "+a+'="'+b+'"'}),j+="]",h.length&&(j+=h+"[/"+i+"]"),b=b.replace(new RegExp(f,"g"),j)}return b},updateCounter:function(){if(this.visualLoadCounter.count++,this.visualLoadCounter.count==this.visualLoadCounter.total){var a=b.getContent({format:"numeric"});b.setContent(a.replace(/(&#8203;)+/g,"&#8203;")),USL_tinymce.loading(!1)}},getLiteralAtts:function(b,c){var d=b.match(/\s.*?(?==)/g),e=b.match(/"([^"]+)"/g),f={};if(null!==d)for(var g=0;g<d.length;g++)f[d[g].trim()]=e[g].substring(1,e[g].length-1);return c&&a.each(c,function(a,b){f[a]||(f[a]=b)}),f},getLiteralContent:function(a){var b=a.match(/\](.*)\[/);return null!==b?b[1]:!1},getLiteralCode:function(a){var b=a.match(/\[(.*?)(?=\s|])/);return null!==b?b[1]:!1},getVisualAtts:function(a){var b=a.match(/<span class="usl-tinymce-shortcode-atts.*?data-atts="(.*?), ".*?<\/span>/i);return b?JSON.parse("{"+b[1].replace(/&quot;/gi,'"')+"}"):!1},getVisualContent:function(a){var b=a.match(/<span class="usl-tinymce-shortcode-content.*?>(.*?)<\/span>/i);return b?b[1]:!1},getVisualCode:function(a){var b=a.match(/<span class="usl-tinymce-shortcode-code.*?data-code="(.*?)".*?<\/span>/i);return b[1]},showContent:function(a,b){var c=b.length?" "+b.join(" "):"";return'<span class="usl-tinymce-shortcode-content'+c+'">'+a+"</span>"}}}(jQuery);var USL_Modal;!function(a){function b(){this.original_value=null,this.fieldname=null,this.shortcode=null,this.$container=null,this.$input=null,this.init=function(a){this.$container=a,this.$input=this.$container.find(".usl-modal-att-input"),this.fieldname=this.$container.find(".usl-modal-att-name").text().trim(),this.shortcode=this.$container.closest(".usl-modal-shortcode").attr("data-code"),this._storeOriginalValue()},this._storeOriginalValue=function(){this.original_value=this.$input.val(),this.storeOriginalValue()},this._revert=function(){this.$input.val(this.original_value),this.setValid(),this.revert()},this.getValue=function(){return this.$input.val()},this.setValue=function(a){this.$input.val(a)},this.setInvalid=function(a){this.$container.addClass("invalid"),this.errorMsg(a)},this.setValid=function(){this.$container.removeClass("invalid")},this.errorMsg=function(a){"undefined"==typeof this.$errormsg&&(this.$errormsg=this.$container.find(".usl-modal-att-errormsg")),this.$errormsg.html(a)},this.storeOriginalValue=function(){},this.revert=function(){}}var c,d,e,f={},g=150,h=!1,j=!1;USL_Modal={output:"",init:function(){this.establishElements(),this.binds(),this.keyboardShortcuts(),this.preventWindowScroll(),this.search(),this.slidersInit(),this.colorpickersInit()},load:function(){},resize:function(){this.listHeight()},establishElements:function(){f.wrap=a("#usl-modal-wrap"),f.submit=a("#usl-modal-submit"),f.backdrop=a("#usl-modal-backdrop"),f.cancel=f.wrap.find(".usl-modal-cancel"),f.close=f.wrap.find(".usl-modal-close"),f.remove=a("#usl-modal-remove"),f.title=f.wrap.find(".usl-modal-title"),f.search=f.wrap.find(".usl-modal-search"),f.categories=f.wrap.find(".usl-modal-categories"),f.footer=f.wrap.find(".usl-modal-footer"),f.list=f.wrap.find(".usl-modal-shortcodes"),f.search_input=f.wrap.find('input[name="usl-modal-search"]'),f.active_shortcode=!1,f.last_active_shortcode=!1},binds:function(){f.list.find(".accordion-section-title, .usl-modal-sc-title").click(function(){USL_Modal.activateShortcode(a(this))}),f.submit.off("click").click(function(a){a.preventDefault(),USL_Modal.update()}),f.remove.click(function(){a(document).trigger("usl-modal-remove")}),f.cancel.click(function(a){a.preventDefault(),USL_Modal.close()}),f.close.click(function(a){a.preventDefault(),USL_Modal.close()}),f.categories.find("li").click(function(){USL_Modal.filterByCategory(a(this))}),f.list.find(".usl-modal-show-advanced-atts").click(function(){return USL_Modal.toggleAdvancedAtts(a(this)),!1}),f.categories.find(".usl-modal-categories-left").click(USL_Modal.moveCategoriesLeft),f.categories.find(".usl-modal-categories-right").click(USL_Modal.moveCategoriesRight)},keyboardShortcuts:function(){a(document).keyup(function(b){if(j)switch(b.which){case 13:b.preventDefault(),USL_Modal.update();break;case 27:USL_Modal.close();break;case 9:f.search.find('input[type="text"]').is(":focus")&&(b.preventDefault(),f.active_shortcode?f.active_shortcode.find(".usl-modal-att-row").first().focus():f.list.find("li").each(function(){if(a(this).is(":visible")){var b=a(this);return c.length&&c.is(":visible")&&(f.active_shortcode=b,USL_Modal.openShortcode()),!1}}));break;case 40:b.preventDefault();var c;f.active_shortcode?(c=f.active_shortcode.next(),c.length&&c.is(":visible")?(USL_Modal.closeShortcode(),f.active_shortcode=c,USL_Modal.openShortcode()):f.active_shortcode.effect("shake",{distance:10},200)):f.list.find("li").each(function(){return a(this).is(":visible")?(c=a(this),c.length&&c.is(":visible")&&(f.active_shortcode=c,USL_Modal.openShortcode()),!1):void 0});break;case 38:b.preventDefault();var d;f.active_shortcode?(d=f.active_shortcode.prev(),d.length&&d.is(":visible")?(USL_Modal.closeShortcode(),f.active_shortcode=d,USL_Modal.openShortcode()):f.active_shortcode.effect("shake",{distance:10},200)):a(f.list.find("li").get().reverse()).each(function(){return a(this).is(":visible")?(d=a(this),d.length&&d.is(":visible")&&(f.active_shortcode=d,USL_Modal.openShortcode()),!1):void 0});break;default:return}})},moveCategoriesLeft:function(){var a=f.categories.find("ul"),b=f.categories.find("li").width(),c="auto"!=a.css("left")?parseInt(a.css("left")):0;0>c&&!h&&(h=!0,a.animate({left:c+b},{duration:300,complete:function(){h=!1}}))},moveCategoriesRight:function(){var a=f.categories.find("ul"),b=f.categories.find("li").width(),c=f.categories.find("li").length*b,d=5*b,e=-1*(c-d),g="auto"!=a.css("left")?parseInt(a.css("left")):0;g>e&&!h&&(h=!0,a.animate({left:g+-1*b},{duration:300,complete:function(){h=!1}}))},initAtts:function(){f.active_shortcode.find(".usl-modal-att-row").each(function(){var b,c=a(this).attr("data-att-type");switch(c){case"selectbox":b=new l(a(this));break;case"colorpicker":b=new m(a(this));break;case"slider":b=new n(a(this));break;default:b=new k(a(this))}a(this).data("attObj",b)})},colorpickersInit:function(){f.list.find(".usl-modal-att-colorpicker").each(function(){var b=a(this).data();a(this).wpColorPicker(b)})},slidersInit:function(){f.list.find(".usl-modal-att-slider").each(function(){var b=a(this),c=b.data(),d=b.siblings(".usl-modal-att-slider-value");c.slide=function(a,b){d.val(b.value)},d.change(function(){b.slider("value",a(this).val())}),b.slider(c)})},search:function(){var b=1e3,c=300;f.search_input.on("keyup",function(g){if(9!=g.which&&13!=g.which&&40!=g.which&&38!=g.which){var h=a(this).val(),i=h.match(/[a-zA-Z0-9\s]/g);if(h.length&&(null===i||i.length!==h.length))return void USL_Modal.invalidSearch(!0);if(USL_Modal.invalidSearch(!1),!h.length)return void USL_Modal.clearSearch(c);e||f.list.stop().animate({opacity:0},c),e=!0,clearTimeout(d),d=setTimeout(function(){console.log("bam"),e=!1,f.list.stop().animate({opacity:1},c),f.list.scrollTop(0),USL_Modal.closeShortcode(),f.list.find(".usl-modal-shortcode").each(function(){var b=a(this).find(".usl-modal-shortcode-title").text(),c=a(this).find(".description").text(),d=a(this).attr("data-code"),e=b+c+d;e.indexOf(h)<0?a(this).hide():a(this).show()})},b)}})},clearSearch:function(a){a="undefined"==typeof a?0:a,f.search_input.val(""),f.list.find(".usl-modal-shortcode").show(),clearTimeout(d),this.closeShortcode(),f.list.stop().animate({opacity:1},a),e=!1},invalidSearch:function(a){var b=f.wrap.find(".usl-modal-invalidsearch");a?b.show():b.hide()},activateShortcode:function(a){var b=a.closest(".usl-modal-shortcode");b.hasClass("active")||(USL_Modal.closeShortcode(),f.active_shortcode=b,USL_Modal.openShortcode())},toggleAdvancedAtts:function(a){"Show advanced options"===a.text()?this.showAdvancedAtts(a):this.hideAdvancedAtts(a)},showAdvancedAtts:function(a){var b=a.siblings(".usl-modal-advanced-atts");b.show(),a.text("Hide advanced options")},hideAdvancedAtts:function(a){var b=a.siblings(".usl-modal-advanced-atts");b.hide(),a.text("Show advanced options")},preventWindowScroll:function(){f.list.bind("mousewheel",function(b){return a(this).scrollTop(a(this).scrollTop()-b.originalEvent.wheelDeltaY),!1})},filterByCategory:function(b){{var c=b.attr("data-category"),d=f.list.find("li");f.list.find("li.active")}this.refresh(),this.closeShortcode(),f.active_shortcode=!1,"all"===c?d.show():d.each(function(){c!==a(this).attr("data-category")?a(this).hide():a(this).show()})},resetScroll:function(){f.list.scrollTop(0)},listHeight:function(){var a=f.wrap.innerHeight()-f.title.outerHeight(!0)-f.search.outerHeight(!0)-f.categories.outerHeight(!0)-f.wrap.find(".dashicons-leftright").outerHeight(!0)-f.footer.outerHeight(!0);f.list.height(a)},showRemoveButton:function(){f.remove.show()},hideRemoveButton:function(){f.remove.hide()},modify:function(a,b){"undefined"!=typeof b&&(c=b),a=a.trim();var d=a.match(/\s.*?(?==)/g),e=a.match(/"([^"]+)"/g),f=a.match(/\[(.*?)[\s|\]]/),g=null!==f?f[1].trim():"",h=a.match(/\](.*)\[/),i=null!==h?h[1]:"",j={};if(i.length&&(j.content=i),this.setActiveShortcode(g),null!==d)for(var k=0;k<d.length;k++)j[d[k].trim()]=e[k].substring(1,e[k].length-1);this.open(),this.openShortcode(),this.populateShortcode(j)},setActiveShortcode:function(b){f.list.find("li").each(function(){a(this).attr("data-code")===b&&(f.active_shortcode=a(this))})},populateShortcode:function(b){f.active_shortcode.find(".usl-modal-att-row").each(function(){var c=a(this).data("attObj"),d=c.$input.attr("name");"undefined"!=typeof b[d]&&c.setValue(b[d])})},closeShortcode:function(){f.active_shortcode&&(f.active_shortcode.removeClass("active"),f.active_shortcode.find(".accordion-section-content").slideUp(g),USL_Modal.hideAdvancedAtts(f.active_shortcode.find(".usl-modal-show-advanced-atts")),USL_Modal.refresh(),f.last_active_shortcode=f.active_shortcode,f.active_shortcode=!1)},openShortcode:function(){if(f.active_shortcode){f.active_shortcode.addClass("active"),f.active_shortcode.data("attsInit")||(this.initAtts(),f.active_shortcode.data("attsInit",!0)),f.active_shortcode.hasClass("accordion-section")&&f.active_shortcode.find(".accordion-section-content").slideDown(g);var a=f.active_shortcode.position(),b=f.list.scrollTop(),c=a.top+b;f.last_active_shortcode&&f.active_shortcode.position().top>f.last_active_shortcode.position().top&&f.last_active_shortcode.hasClass("accordion-section")&&(c-=f.last_active_shortcode.find(".accordion-section-content").outerHeight()),f.list.stop().animate({scrollTop:c})}},open:function(b){"undefined"!=typeof b&&(c=b),j=!0,a(document).trigger("usl-modal-open"),f.wrap.show(),f.backdrop.show(),f.search.find('input[name="usl-modal-search"]').focus(),this.listHeight(),a(document).trigger("usl-modal-open")},close:function(){j=!1,f.wrap.hide(),f.backdrop.hide(),this.resetScroll(),this.closeShortcode(),this.clearSearch(),f.list.find(".usl-mce-shortcode.active").removeClass("active open"),a(document).trigger("usl-modal-close")},update:function(){var b=f.list.find("li.active");if(0!==b.length&&this.validate()){this.sanitize();var d,e,g=b.find(".usl-modal-shortcode-form").serializeArray(),h=b.attr("data-code"),j=b.find(".usl-modal-shortcode-title").html();if(d=USL_Data.all_shortcodes[h],e="["+h,g.length)for(i=0;i<g.length;i++)"content"!==g[i].name?g[i].value.length&&(e+=" "+g[i].name+'="'+g[i].value+'"'):c=g[i].value;e+="]",d.wrapping&&(e+=c+"[/"+h+"]"),this.close(),this.output={all:e,code:h,atts:g,title:j},a(document).trigger("usl-modal-update")}},validate:function(){var b=!0;return f.active_shortcode.find(".usl-modal-att-row").each(function(){var c=a(this).data("attObj"),d=c.$container.attr("data-required"),e=c.$container.attr("data-validate"),f=c.getValue(),g=!0;return"1"===d&&!f&&b?(g=!1,b=!1,c.setInvalid("This field is required"),!0):f?(e.length&&(e=USL_Modal._stringToObject(e),a.each(e,function(a,d){switch(a){case"url":var e=/[(http(s)?):\/\/(www\.)?a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/gi;f.match(e)||(g=!1,b=!1,c.setInvalid("Please enter a valid URL"));break;case"email":var h=/[(http(s)?):\/\/(www\.)?a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/gi;f.match(h)||(g=!1,b=!1,c.setInvalid("Please enter a valid Email"));break;case"maxchar":f.length>parseInt(d)&&(g=!1,b=!1,c.setInvalid(f.length-parseInt(d)+" too many characters."));break;case"minchar":f.length<parseInt(d)&&(g=!1,b=!1,c.setInvalid(parseInt(d)-f.length+" too few characters."));break;case"charonly":f.match(/[0-9]/)&&(g=!1,b=!1,c.setInvalid("No numbers please"));break;case"intonly":var i=f.match(/[0-9]+/);i&&i[0]===i.input||(g=!1,b=!1,c.setInvalid("Only numbers please"));break;default:throw new Error('USL -> Unsupported validation method "'+a+'" for the shortcode "'+c.shortcode+'" at field "'+c.fieldname+'"')}})),void(g&&c.setValid())):!0}),b},sanitize:function(){f.active_shortcode.find(".usl-modal-att-row").each(function(){var b=USL_Modal._stringToObject(a(this).attr("data-sanitize")),c=a(this).data("attObj"),d=c.getValue();return d.length?void(b&&a.each(b,function(a){switch(a){case"url":d.match(/https?:\/\//)||c.setValue("http://"+d);break;default:throw new Error('USL -> Unsupported sanitation method "'+a+'" for the shortcode "'+c.shortcode+'" at field "'+c.fieldname+'"')}})):!0})},refresh:function(){f.active_shortcode&&f.active_shortcode.find(".usl-modal-att-row").each(function(){var b=a(this).data("attObj");"undefined"!=typeof b&&b._revert()})},_stringToObject:function(a){return"undefined"!=typeof a&&a.length?(a='"'+a.replace(/(:|,)/g,'"$1"')+'"',a=JSON.parse("{"+a+"}")):!1}};var k=function(a){b.apply(this,arguments),this.getValue=function(){return"textarea"===this.$input.prop("tagName")?this.$input.text():this.$input.val()},this.init(a)},l=function(a){b.apply(this,arguments),this.init(a)},m=function(a){b.apply(this,arguments),this.revert=function(){this.$input.iris("color",this.original_value)},this.setValue=function(a){this.$input.iris("color",a)},this.init(a)},n=function(a){b.apply(this,arguments),this.revert=function(){this.$slider.slider("value",this.original_value)},this.setValue=function(a){this.$input.val(a),this.$slider.slider("value",a)},this.init(a),this.$slider=this.$container.find(".usl-modal-att-slider")};a(function(){USL_Modal.init()}),a(window).load(function(){USL_Modal.load()}),a(window).resize(function(){USL_Modal.resize()})}(jQuery);var USL_Widget;!function(a){var b,c;USL_Widget={init:function(){c=this,this.binds(),a("body").hasClass("wp-customizer")||a(".usl-widget-customizer-message").show()},binds:function(){a(document).on("click",".usl-widget-add-shortcode",function(){USL_Widget.open(a(this))}),a(document).on("usl-modal-update",USL_Widget.update),a(document).on("usl-modal-remove",USL_Widget.remove)},open:function(a){b=a.closest(".widget-content");var c=b.find(".usl-widget-shortcode-preview").html(),d=b.find(".usl-widget-shortcode").val();"no shortcode yet"!=c.toLowerCase().trim()?USL_Modal.modify(d):USL_Modal.open()},update:function(){c._change(USL_Modal.output.all,USL_Modal.output.title,"Modify / Remove Shortcode",USL_Modal.output.title)},remove:function(){USL_Modal.close(),c._change("","","Add Shortcode","No shortcode yet")},_change:function(a,c,d,e){b.find(".usl-widget-add-shortcode").text(d),b.find(".usl-widget-shortcode-preview").text(e),b.find(".usl-widget-shortcode-title").val(c),b.find(".usl-widget-shortcode").val(a),b.find(".usl-widget-shortcode").change()}},a(function(){var b=a("body");(b.hasClass("widgets-php")||b.hasClass("wp-customizer"))&&USL_Widget.init()})}(jQuery);
//# sourceMappingURL=ultimate-shortcodes-library-admin.min.js.map