var Render_tinymce;!function(a){var b=!1,c=0,d=Render_Data.all_shortcodes,e=Render_Data.l18n,f=a("#render-modal-wrap").find(".render-modal-shortcodes");Render_tinymce={active_editor:null,init:function(){this.addToTinymce(),this.binds(),this.createLoaders()},binds:function(){a(document).on("render-modal-close",function(){Render_tinymce.close()}),a(document).on("render-modal-update",function(){Render_tinymce.update()}),a(document).on("render-modal-remove",function(){Render_tinymce.removeShortcode()}),a(document).on("render-tinymce-post-render",function(){Render_tinymce.postRender()}),a("#post").submit(function(b){Render_tinymce.submit(b,a(this))})},editorBinds:function(b){b.on("mouseover",".render-tinymce-shortcode-wrapper:not(.hide-actions)",function(c){c.stopPropagation(),b.find(".render-tinymce-shortcode-wrapper-actions.active").removeClass("active"),a(this).find("> .render-tinymce-shortcode-wrapper-actions").addClass("active")}),b.on("mouseleave",".render-tinymce-shortcode-wrapper",function(a){a.stopPropagation(),b.find(".render-tinymce-shortcode-wrapper-actions.active:not(.hide-actions)").removeClass("active")})},addToTinymce:function(){tinymce.PluginManager.add("render",function(b){var c;b.addButton("render_open",{icon:"render-mce-icon",cmd:"Render_Open",tooltip:e.add_shortcode}),b.addCommand("Render_Open",function(){var c,d;Render_Data.do_render?(c=b.selection.getContent({format:"html"}),d="<div>"+c+"</div>",a(d).text().trim().length&&(Render_Modal.selection=Render_tinymce.loadText(d).slice(5,Render_Modal.selection.length-6))):Render_Modal.selection=b.selection.getContent(),Render_tinymce.active_editor=b,Render_tinymce.open(null)}),b.addShortcut("alt+shift+s","","render-open"),Render_Data.do_render&&(b.addButton("render_refresh",{icon:"render-mce-refresh-icon",cmd:"Render_Refresh",tooltip:"Refresh Editor"}),b.addCommand("Render_Refresh",function(){Render_tinymce.active_editor=b,Render_tinymce.loadVisual()}),b.onClick.add(function(b,d){Render_tinymce.active_editor=b;var e,f,g,h;c=a(b.getBody()),c.find(".render-tinymce-shortcode-wrapper.delete").removeClass("delete"),a(d.target).hasClass("render-tinymce-shortcode-wrapper-edit")&&(e=a(d.target).closest(".render-tinymce-shortcode-wrapper"),f=e.find(".render-tinymce-shortcode-content").html(),g=a("<div />").append(e.clone()).html(),h=Render_tinymce.convertRenderedToLiteral(g),f&&f.length&&(Render_Modal.selection=f),e.addClass("render-tinymce-editing"),Render_tinymce.open(h)),a(d.target).hasClass("render-tinymce-shortcode-wrapper-remove")&&(a(d.target).closest(".render-tinymce-shortcode-wrapper").addClass("render-tinymce-editing"),Render_tinymce.removeShortcode())}),b.onKeyDown.add(function(b,c){Render_tinymce.active_editor=b;var d=b.selection.getNode(),e=a(d).html();if(!d||a(d).hasClass("render-tinymce-shortcode-content")){var f=b.selection.getRng().startContainer,g=b.selection.getBookmark(f.textContent).rng;if("undefined"!=typeof g){var h=g.startOffset,i=a("<div />").html(e).text();return 0!==h||8!==c.which&&37!==c.which?h===i.length&&39===c.which?(c.preventDefault(),!1):void 0:(c.preventDefault(),!1)}}}),b.onKeyPress.add(function(b,c){Render_tinymce.active_editor=b;var d=b.selection.getNode(),e=a(d).html();if(!d||a(d).hasClass("render-tinymce-shortcode-content")){var f=b.selection.getRng().startContainer,g=b.selection.getBookmark(f.textContent).rng;if("undefined"!=typeof g){var h=g.startOffset,i=(0!=h?e.slice(h-1,h):"",a("<div />").html(e).text());if(h===i.length){var j=String.fromCharCode(c.charCode);return" "===j&&(j="&nbsp;"),a(d).html(i+j),b.selection.select(d,!0),b.selection.collapse(!1),c.preventDefault(),!1}}}}),b.on("nodechange",function(c){if(Render_tinymce.active_editor=b,"IMG"==c.element.nodeName){var d,e,f=a(c.element),g=f.closest(".render-tinymce-shortcode-wrapper"),h=a(b.getBody());g.length&&(d=Render_Data.all_shortcodes[g.data("code")].render,("undefined"==typeof d||"undefined"==typeof d.allowImageEditing)&&setTimeout(function(){e=h.find(".mce-resizehandle"),e.hide()},1))}}),b.on("init",function(){Render_tinymce.active_editor=b,Render_tinymce.editorBinds(a(b.getBody()))}),b.on("init show",function(){Render_tinymce.active_editor=b,Render_tinymce.loadVisual()}),b.on("PostProcess",function(a){a.content=Render_tinymce.loadText(a.content)}))})},createLoaders:function(){a(".wp-editor-container").append('<div class="render-tinymce-loader hide"><div class="spinner"></div><div class="text">></div></div>')},loadVisual:function(){var a=Render_tinymce.active_editor.getContent();a=Render_tinymce.loadText(a),Render_tinymce.convertLiteralToRendered(a)},postRender:function(){var b=a(Render_tinymce.active_editor.getBody());b.find(".render-tinymce-shortcode-wrapper").each(function(){var b=a(this).parent().contents();if(b[b.length-1]==a(this).get(0)){var c=a(this).prop("tagName").toLowerCase(),d=a("<"+c+' class="render-tinymce-dummy-container">&#8203;</'+c+">");a(this).after(d)}})},loadText:function(a){return a=a.replace(/&#8203;/g,""),a=Render_tinymce.convertRenderedToLiteral(a)},visualToLiteral:function(b){var c=a(b).data("code"),d=a(b).data("atts"),e=a(b).find(".render-tinymce-shortcode-content").html(),f="["+c;return d&&(d=JSON.parse(d),a.each(d,function(a,b){b.length&&(f+=" "+a+"='"+b+"'")})),f+="]",e&&(f+=e+"[/"+c+"]"),f},open:function(b){"undefined"!=typeof b&&null!==b?Render_Modal.modify(b):(Render_Modal.selection||f.find(".render-modal-shortcode.wrapping:not(.nested-parent)").each(function(){Render_Modal.disableShortcode(a(this),e.select_content_from_editor)}),Render_Modal.open());var c=a(Render_tinymce.active_editor.selection.getNode()),d=c.length?c.closest(".nested-child"):!1;if(d.length){var g=d.parent().closest(".render-tinymce-shortcode-wrapper").data("code");f.find('.render-modal-shortcode[data-code="'+g+'"]').each(function(){Render_Modal.disableShortcode(a(this),e.cannot_place_shortcode_here)})}},close:function(){this.active_editor.focus()},update:function(){var b=a(this.active_editor.dom.select(".render-tinymce-editing"));b.length&&this.active_editor.selection.select(b.get(0)),this.active_editor.selection.getContent().length?this.active_editor.selection.setContent(Render_Modal.output.all):this.active_editor.insertContent(Render_Modal.output.all),Render_Data.do_render&&this.loadVisual()},removeShortcode:function(){var b=a("<div />").append(a(Render_tinymce.active_editor.getBody()).html()),c=b.find(".render-tinymce-editing"),e=c.find(".render-tinymce-shortcode-content"),f=d[c.data("code")].render,g="undefined"!=typeof f&&"undefined"!=typeof f.nested;e.length&&!g?c.replaceWith(e.contents()):c.remove(),this.active_editor.setContent(b.html()),Render_Modal.close()},loading:function(d){var e=a(Render_tinymce.active_editor.getContainer()).closest(".wp-editor-container").find(".render-tinymce-loader");if(d){b=!0,setTimeout(function(){b=!1},1e3);var f=Render_Data.loading_messages,g=Math.floor(Math.random()*f.length);if(g==c)for(;g==c;)g=Math.floor(Math.random()*f.length);c=g,e.find(".text").html(f[g]),e.removeClass("hide"),a("#content-html").prop("disabled",!0),a("#content-tmce").prop("disabled",!0),a("#wp-content-media-buttons").addClass("disabled")}else e.addClass("hide"),a("#content-html").prop("disabled",!1),a("#content-tmce").prop("disabled",!1),a("#wp-content-media-buttons").removeClass("disabled")},getEditor:function(){return this.active_editor},convertLiteralToRendered:function(b){Render_tinymce.loading(!0);var c;"undefined"!=typeof Render_Data.render_data&&(c=Render_Data.render_data),c.action="render_render_shortcodes",c.content=b,c.shortcode_data=Render_Data.rendered_shortcodes,a.ajax({url:ajaxurl,method:"POST",data:c,editor:this.active_editor,success:function(b){Render_tinymce.active_editor=this.editor,Render_tinymce.active_editor.setContent(b),a(Render_tinymce.active_editor.getBody()).find(".no-js").css("display","none"),Render_tinymce.loading(!1),a(document).trigger("render-tinymce-post-render")}})},convertRenderedToLiteral:function(b){var c=a("<div />").append(b);c.find(".render-tinymce-dummy-container").each(function(){a(this).replaceWith(this.childNodes)});var d=c.find(".render-tinymce-shortcode-wrapper").sortByDepth();return d.each(function(){var b=a(this).data("atts"),c=a(this).data("code"),d=a(this).find(".render-tinymce-shortcode-content").first().html(),e="["+c;if(b){"object"!=typeof b&&(b=JSON.parse(b));var f="";a.each(b,function(a,b){f+=" "+a+"='"+b+"'"}),e+=f}e+="]",d&&(e+=d+"[/"+c+"]"),a(this).replaceWith(e)}),c.html()}},a(function(){Render_tinymce.init()}),window.RenderRefreshTinyMCE=function(){Render_tinymce.loadVisual()}}(jQuery);
//# sourceMappingURL=plugin.min.js.map