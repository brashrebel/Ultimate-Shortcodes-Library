var Render_tinymce;!function(a){var b=!1,c=0,d=Render_Data.all_shortcodes,e=Render_Data.l18n,f=a("#render-modal-wrap").find(".render-modal-shortcodes");Render_tinymce={active_editor:null,$shortcode_content_editor:null,editing_shortcode_content_editor:null,init:function(){this.$shortcode_content_editor=a("#render-tinymce-sc-content-editor"),this.addToTinymce(),this.binds(),this.keyboardShortcuts(),this.createLoaders()},binds:function(){a(document).on("render-modal-close",function(){Render_tinymce.close()}),a(document).on("render-modal-update",function(){Render_tinymce.update()}),a(document).on("render-modal-remove",function(){Render_tinymce.removeShortcode()}),a(document).on("render-tinymce-post-render",function(){Render_tinymce.postRender()}),this.$shortcode_content_editor.find(".submit").click(function(){return Render_tinymce.updateShortcodeContent(),!1}),this.$shortcode_content_editor.find(".cancel").click(function(){return Render_tinymce.closeShortcodeContentEditor(),!1}),Render_Modal.getElement("backdrop").click(function(a){null!==Render_tinymce.editing_shortcode_content_editor&&(Render_tinymce.closeShortcodeContentEditor(),a.preventDefault())})},keyboardShortcuts:function(){a(document).keyup(function(a){if(null!==this.editing_shortcode_content_editor)switch(a.which){case 27:a.preventDefault(),Render_tinymce.closeShortcodeContentEditor()}})},editorBinds:function(b){b.on("mouseover",".render-tinymce-shortcode-wrapper:not(.hide-actions)",function(c){c.stopPropagation(),b.find(".render-tinymce-shortcode-wrapper-actions.active").removeClass("active"),a(this).find("> .render-tinymce-shortcode-wrapper-actions").addClass("active")}),b.on("mouseleave",".render-tinymce-shortcode-wrapper",function(a){a.stopPropagation(),b.find(".render-tinymce-shortcode-wrapper-actions.active:not(.hide-actions)").removeClass("active")})},addToTinymce:function(){tinymce.PluginManager.add("render",function(b){b.addButton("render_open",{icon:"render-mce-icon",cmd:"Render_Open",tooltip:e.add_shortcode}),b.addCommand("Render_Open",function(){var c,d;Render_Data.do_render?(c=b.selection.getContent({format:"html"}),d="<div>"+c+"</div>",a(d).text().trim().length&&(Render_Modal.selection=Render_tinymce.loadText(d).slice(5,Render_Modal.selection.length-6))):Render_Modal.selection=b.selection.getContent(),Render_tinymce.active_editor=b,Render_tinymce.open(null)}),b.addShortcut("alt+shift+s","","render-open"),Render_Data.do_render&&(b.addButton("render_refresh",{icon:"render-mce-refresh-icon",cmd:"Render_Refresh",tooltip:"Refresh Editor"}),b.addCommand("Render_Refresh",function(){Render_tinymce.active_editor=b,Render_tinymce.loadVisual()}),b.onClick.add(function(b,c){Render_tinymce.active_editor=b;var d,e,f,g=a(c.target).closest(".render-tinymce-shortcode-wrapper");a(c.target).hasClass("render-tinymce-shortcode-wrapper-edit")?(d=g.find(".render-tinymce-shortcode-content").html(),e=a("<div />").append(g.clone()).html(),f=Render_tinymce.convertRenderedToLiteral(e),d&&d.length&&(Render_Modal.selection=d),g.addClass("render-tinymce-editing"),Render_tinymce.open(f)):a(c.target).hasClass("render-tinymce-shortcode-wrapper-remove")?(a(c.target).closest(".render-tinymce-shortcode-wrapper").addClass("render-tinymce-editing"),Render_tinymce.removeShortcode()):"render-tinymce-shortcode-content"!=b.id&&!g.find(".nested-child").length&&g.length&&g.find(".render-tinymce-shortcode-content").length&&(g.addClass("render-tinymce-editing-content"),Render_tinymce.editShortcodeContent())}),b.on("nodechange",function(c){if(Render_tinymce.active_editor=b,"IMG"==c.element.nodeName){var d,e,f=a(c.element),g=f.closest(".render-tinymce-shortcode-wrapper"),h=a(b.getBody());g.length&&(d=Render_Data.all_shortcodes[g.data("code")].render,("undefined"==typeof d||"undefined"==typeof d.allowImageEditing)&&setTimeout(function(){e=h.find(".mce-resizehandle"),e.hide()},1))}}),b.on("init",function(){Render_tinymce.active_editor=b,Render_tinymce.editorBinds(a(b.getBody()))}),b.on("init show",function(){setTimeout(function(){Render_tinymce.active_editor=b,Render_tinymce.loadVisual()},1)}),b.on("PostProcess",function(a){a.content=Render_tinymce.loadText(a.content)}))})},editShortcodeContent:function(){this.editing_shortcode_content_editor=this.active_editor;var b=a(this.editing_shortcode_content_editor.getBody()).find(".render-tinymce-editing-content"),c=a("<div />"),d=b.find(".render-tinymce-shortcode-content").html();c.append(d),c.find(".render-tinymce-shortcode-placeholder").remove(),d=c.html(),this.openShortcodeContentEditor(b,d)},updateShortcodeContent:function(){var b=tinymce.get("render-tinymce-shortcode-content"),c=b.getContent(),e=a(this.editing_shortcode_content_editor.getBody()).find(".render-tinymce-editing-content"),f=e.data("code");d[f].render&&d[f].render.onlyAllowInline&&(c=c.replace(new RegExp(Render_Data.block_regex,"gi"),"")),e.find(".render-tinymce-shortcode-content").html(c),this.closeShortcodeContentEditor(),Render_Data.do_render?this.loadVisual():e.removeClass("render-tinymce-editing-content")},closeShortcodeContentEditor:function(){var b=a(this.editing_shortcode_content_editor.getBody()).find(".render-tinymce-editing-content");b.removeClass("render-tinymce-editing-content"),this.$shortcode_content_editor.hide().removeClass("active"),Render_Modal.getElement("backdrop").hide(),Render_Modal.keepBackdrop=!1,this.active_editor=this.editing_shortcode_content_editor,this.editing_shortcode_content_editor=null},openShortcodeContentEditor:function(b,c){tinymce.EditorManager.execCommand("mceRemoveEditor",!0,"render-tinymce-shortcode-content"),Render_Modal.getElement("backdrop").show(),Render_Modal.keepBackdrop=!0,this.$shortcode_content_editor.find(".render-tinymce-sc-content-editor-title-sc-name").html(b.data("name"));var d=a(window).width()<500?.9*a(window).width():500,e=a(window).height()<600?.9*a(window).height():600,f=d/2*-1,g=e/2*-1,h=a(this.editing_shortcode_content_editor.getContainer()),i=b.offset().left+b.width()/2+h.offset().left,j=b.offset().top+b.height()/2+h.offset().top,k=300;this.$shortcode_content_editor.css({width:d,height:e,marginLeft:f,marginTop:g,left:i,top:j}),this.$shortcode_content_editor.show().delay(100).animate({left:"50%",top:"50%"},k),this.$shortcode_content_editor.find(".render-tinymce-sc-content-editor-container").hide().show("scale",{origin:["middle","center"],percent:100,scale:"box",complete:function(){setTimeout(function(){var b=Render_tinymce.$shortcode_content_editor;b.addClass("active"),tinymce.EditorManager.execCommand("mceAddEditor",!0,"render-tinymce-shortcode-content");var d=tinymce.get("render-tinymce-shortcode-content");d.setContent(c);var e=a("#wp-render-tinymce-shortcode-content-wrap");e.find(".mce-edit-area").css("height",b.height()-(e.height()-e.find(".mce-edit-area").height())-b.find(".render-tinymce-sc-content-editor-actions").outerHeight(!0)-b.find(".render-tinymce-sc-content-editor-title").outerHeight(!0))},1)}},k)},createLoaders:function(){a(".wp-editor-container").append('<div class="render-tinymce-loader hide"><div class="spinner"></div><div class="text">></div></div>')},loadVisual:function(){var a=Render_tinymce.active_editor.getContent();a=Render_tinymce.loadText(a),Render_tinymce.convertLiteralToRendered(a)},postRender:function(){var b=a(Render_tinymce.active_editor.getBody());b.find(".render-tinymce-shortcode-wrapper").each(function(){var b=a(this).parent().contents();if(b[b.length-1]==a(this).get(0)){var c=a(this).prop("tagName").toLowerCase(),d=a("<"+c+' class="render-tinymce-dummy-container">&#8203;</'+c+">");a(this).after(d)}})},loadText:function(a){return a=a.replace(/&#8203;/g,""),a=Render_tinymce.convertRenderedToLiteral(a)},visualToLiteral:function(b){var c=a(b).data("code"),d=a(b).data("atts"),e=a(b).find(".render-tinymce-shortcode-content").html(),f="["+c;return d&&(d=JSON.parse(d),a.each(d,function(a,b){b.length&&(f+=" "+a+"='"+b+"'")})),f+="]",e&&(f+=e+"[/"+c+"]"),f},open:function(b){"undefined"!=typeof b&&null!==b?Render_Modal.modify(b):(Render_Modal.selection||f.find(".render-modal-shortcode.wrapping:not(.nested-parent)").each(function(){Render_Modal.disableShortcode(a(this),e.select_content_from_editor)}),Render_Modal.open());var c=a(Render_tinymce.active_editor.selection.getNode()),d=c.length?c.closest(".nested-child"):!1;if(d.length){var g=d.parent().closest(".render-tinymce-shortcode-wrapper").data("code");f.find('.render-modal-shortcode[data-code="'+g+'"]').each(function(){Render_Modal.disableShortcode(a(this),e.cannot_place_shortcode_here)})}},close:function(){this.active_editor.focus()},update:function(){var b=a(this.active_editor.dom.select(".render-tinymce-editing"));b.length&&this.active_editor.selection.select(b.get(0)),this.active_editor.selection.getContent().length?this.active_editor.selection.setContent(Render_Modal.output.all):this.active_editor.insertContent(Render_Modal.output.all),Render_Data.do_render&&this.loadVisual()},removeShortcode:function(){var b=a("<div />").append(a(Render_tinymce.active_editor.getBody()).html()),c=b.find(".render-tinymce-editing"),e=c.find(".render-tinymce-shortcode-content"),f=d[c.data("code")].render,g="undefined"!=typeof f&&"undefined"!=typeof f.nested;e.length&&!g?c.replaceWith(e.contents()):c.remove(),this.active_editor.setContent(b.html()),Render_Modal.close()},loading:function(d){var e=a(Render_tinymce.active_editor.getContainer()).closest(".wp-editor-container").find(".render-tinymce-loader");if(d){b=!0,setTimeout(function(){b=!1},1e3);var f=Render_Data.loading_messages,g=Math.floor(Math.random()*f.length);if(g==c)for(;g==c;)g=Math.floor(Math.random()*f.length);c=g,e.find(".text").html(f[g]),e.removeClass("hide"),a("#content-html").prop("disabled",!0),a("#content-tmce").prop("disabled",!0),a("#wp-content-media-buttons").addClass("disabled")}else e.addClass("hide"),a("#content-html").prop("disabled",!1),a("#content-tmce").prop("disabled",!1),a("#wp-content-media-buttons").removeClass("disabled")},getEditor:function(){return this.active_editor},convertLiteralToRendered:function(b){Render_tinymce.loading(!0);var c;"undefined"!=typeof Render_Data.render_data&&(c=Render_Data.render_data),c.action="render_render_shortcodes",c.content=b,c.shortcode_data=Render_Data.rendered_shortcodes,c.editor_id=this.active_editor.id,a.ajax({url:ajaxurl,method:"POST",data:c,editor:this.active_editor,success:function(b){Render_tinymce.active_editor=this.editor,Render_tinymce.active_editor.setContent(b),a(Render_tinymce.active_editor.getBody()).find(".no-js").css("display","none"),Render_tinymce.loading(!1),a(document).trigger("render-tinymce-post-render")}})},convertRenderedToLiteral:function(b){var c=a("<div />").append(b);c.find(".render-tinymce-dummy-container").each(function(){a(this).replaceWith(this.childNodes)}),c.find(".render-tinymce-shortcode-placeholder").remove();var e=c.find(".render-tinymce-shortcode-wrapper").sortByDepth();return e.each(function(){var b=a(this).data("atts"),c=a(this).data("code"),e=a(this).find(".render-tinymce-shortcode-content").first().html(),f="["+c;if(b){"object"!=typeof b&&(b=JSON.parse(b));var g="";a.each(b,function(a,b){g+=" "+a+"='"+b+"'"}),f+=g}f+="]",d[c].wrapping&&(f+=(e||"")+"[/"+c+"]"),a(this).replaceWith(f)}),c.html()}},a(function(){Render_tinymce.init()}),window.RenderRefreshTinyMCE=function(){Render_tinymce.loadVisual()}}(jQuery);
//# sourceMappingURL=plugin.min.js.map