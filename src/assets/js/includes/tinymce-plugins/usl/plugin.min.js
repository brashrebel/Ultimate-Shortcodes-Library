var USL_tinymce;!function(a){var b,c,d,e,f,g=!1,h=0,i=!1,j="";USL_tinymce={init:function(){this.addToTinymce(),this.binds(),d=a("#wp-content-editor-container"),c=d.find(".wp-editor-area"),this.createLoader()},binds:function(){a(document).on("usl-modal-close",function(){USL_tinymce.close()}),a(document).on("usl-modal-update",function(){USL_tinymce.update()}),a(document).on("usl-modal-remove",function(){USL_tinymce.removeShortcode()}),a(document).on("usl-tinymce-post-render",function(){USL_tinymce.postRender()}),a("#post").submit(function(b){USL_tinymce.submit(b,a(this))})},addToTinymce:function(){tinymce.PluginManager.add("usl",function(d){b=d,d.addCommand("USL_Open",function(){var c=b.selection.getNode();if(USL_Modal.selection=b.selection.getContent(),f=!1,a(c).closest(".usl-tinymce-shortcode-wrapper").length||a(c).hasClass("usl-tinymce-shortcode-wrapper")){var d=a(c).hasClass("usl-tinymce-shortcode-wrapper")?a(c):a(c).closest(".usl-tinymce-shortcode-wrapper"),e=d.find(".usl-tinymce-shortcode-content").html(),g=a("<div />").append(d.clone()).html(),h=USL_tinymce.visualToLiteral(g);USL_Modal.selection.length||(USL_Modal.selection=e,f=!0),USL_Modal.modify(h)}else USL_Modal.open()}),d.addCommand("USL_Refresh",function(){USL_tinymce.loadVisual()}),d.addButton("usl_open",{icon:"usl-mce-icon",cmd:"USL_Open",tooltip:"Add Shortcode",onPostRender:function(){var c=this;b.on("nodechange",function(b){var d=a(b.element).hasClass("usl-tinymce-shortcode-wrapper")?a(b.element):a(b.element).closest(".usl-tinymce-shortcode-wrapper"),e=d.length?!0:!1;j.length&&j.removeClass("active"),e&&(j=d,j.addClass("active")),c.active(e)})}}),d.addButton("usl_refresh",{icon:"usl-mce-refresh-icon",cmd:"USL_Refresh",tooltip:"Refresh Editor"}),d.addShortcut("alt+shift+s","","usl-open"),d.onClick.add(function(b){var c=a(b.getBody());c.find(".usl-tinymce-shortcode-wrapper.delete").removeClass("delete")}),d.onKeyDown.add(function(b,c){if(8==c.keyCode){var d=b.selection.getRng().startContainer,e=b.selection.getBookmark(d.textContent).rng,f=b.selection.getNode(),g=e.startContainer.textContent;if("undefined"==typeof e)return;var h=e.startOffset,i=a(e.startContainer),j=a(e.startContainer.previousElementSibling);if(j.length||(j=i.prev()),j.length||(j=i.parent().prev()),(0===h||!g.trim().length||8203===g.charCodeAt(h-1))&&j.hasClass("usl-tinymce-shortcode-wrapper"))return j.hasClass("delete")?j.remove():j.addClass("delete"),c.preventDefault(),!1;a(f).html().length<=1&&a(f).closest(".usl-tinymce-shortcode-wrapper").remove(),0===h&&a(f).hasClass("usl-tinymce-shortcode-content")&&c.preventDefault()}else{var k=a(b.getBody());k.find(".usl-tinymce-shortcode-wrapper.delete").removeClass("delete")}}),d.onKeyPress.add(function(b,c){var d=b.selection.getNode(),e=a(d).html();if(!d||a(d).hasClass("usl-tinymce-shortcode-content")){var f=b.selection.getRng().startContainer,g=b.selection.getBookmark(f.textContent).rng;if("undefined"!=typeof g){var h=g.startOffset,i=(0!=h?e.slice(h-1,h):"",a("<div />").html(e).text());if(h===i.length){var j=String.fromCharCode(c.charCode);" "===j&&(j="&nbsp;"),c.preventDefault(),a(d).html(i+j),b.selection.select(d,!0),b.selection.collapse(!1)}}}}),d.on("init show",USL_tinymce.loadVisual),d.on("hide",function(){var a=b.getContent({format:"numeric"});c.val(window.switchEditors.pre_wpautop(USL_tinymce.loadText(a)))})})},createLoader:function(){d.append('<div id="usl-tinymce-loader" class="hide"><div class="spinner"></div><div class="text">></div></div>'),e=a("#usl-tinymce-loader")},loadVisual:function(){if(USL_Data.do_render){var a=b.getContent();USL_MCECallbacks.convertLiteralToRendered(a,b)}},postRender:function(){var c=a(b.getBody());c.find(".usl-tinymce-shortcode-wrapper").each(function(){a(this).parent().contents().last()[0]==a(this)[0]&&a(this).after("&#8203;")})},loadText:function(a){return a=USL_MCECallbacks.convertRenderedToLiteral(a),a=a.replace(/<span class="usl-tinymce-divider usl-tinymce-noneditable">.*?<\/span>/g,""),a=a.replace(/<p class="usl-tinymce-divider.*?>.*?<\/p>/g,"")},visualToLiteral:function(b){var c=a(b).attr("data-code"),d=a(b).attr("data-atts"),e=a(b).find(".usl-tinymce-shortcode-content").html(),f="["+c;return d&&(d=JSON.parse(usl_encode_attr(d,['"'])),a.each(d,function(a,b){b.length&&(f+=" "+a+"='"+b+"'")})),f+="]",e&&(f+=e+"[/"+c+"]"),f},close:function(){b.focus()},update:function(){var c=b.selection.getNode(),d=a(c).hasClass("usl-tinymce-shortcode-wrapper")?a(c):a(c).closest(".usl-tinymce-shortcode-wrapper"),e=d.next(".usl-tinymce-divider");d.length?(d.replaceWith(USL_Modal.output.all),b.dom.remove(e[0])):b.insertContent(USL_Modal.output.all),this.loadVisual()},removeShortcode:function(){var c=b.selection.getNode(),d=a(c).hasClass("usl-tinymce-shortcode-wrapper")?a(c):a(c).closest(".usl-tinymce-shortcode-wrapper"),e=d.next(".usl-tinymce-divider");b.dom.remove(d[0]),b.dom.remove(e[0]),USL_Modal.close()},loading:function(b){function c(){return g?void setTimeout(c,50):(e.addClass("hide"),a("#content-html").prop("disabled",!1),a("#content-tmce").prop("disabled",!1),void a("#wp-content-media-buttons").removeClass("disabled"))}if(b){g=!0,setTimeout(function(){g=!1},1500);var d=USL_Data.loading_messages,f=Math.floor(Math.random()*d.length);if(f==h)for(;f==h;)f=Math.floor(Math.random()*d.length);h=f,e.find(".text").html(d[f]),e.removeClass("hide"),a("#content-html").prop("disabled",!0),a("#content-tmce").prop("disabled",!0),a("#wp-content-media-buttons").addClass("disabled")}else c()},submit:function(a,c){if(!i){i=!0,a.preventDefault();var d=b.getContent();b.on("PostProcess",function(a){a.content=USL_tinymce.loadText(d)}),c.submit()}}},a(function(){USL_tinymce.init()})}(jQuery);
//# sourceMappingURL=plugin.min.js.map